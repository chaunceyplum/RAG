{
    "url": "https://docs.snowflake.com/en/developer-guide/native-apps/update-app-upgrade",
    "title": "Upgrade an app | Snowflake Documentation",
    "paragraphs": [
        "Feature \u2014 Generally Available",
        "The Snowflake Native App Framework is generally available on supported cloud platforms. For additional information, see\nSupport for private connectivity, VPS, and government regions.",
        "This topic provides information on upgrading a Snowflake Native App.",
        "The Snowflake Native App Framework allows providers to upgrade an app to a new version or patch. To see how\nupgrades fit in the overall workflow for developing a new version or patch of an app, see\nWorkflow for updating an app.",
        "Providers can initiate an upgrade of an app to a new version or patch by setting a release directive\non the application package. When the release directive is modified, Snowflake automatically upgrades\nall installed instances of the current version of the app to the version specified by the release directive.",
        "When the provider initiates an upgrade, Snowflake adds each app to be upgraded to a queue. Each\napp is upgraded as resources are available. The upgrade process can take a while to complete across all\ninstalled versions of the app. To expedite the upgrade process, consumers can also manually initiate an upgrade\nof an app when a new version or patch is available.",
        "Note",
        "After the upgrade process begins for their app, consumers can no longer manually upgrade the app.",
        "A provider upgrades an installed app by using the following workflow:",
        "Update the app to include any new features.",
        "If you are creating a new version of the app and there are two versions currently defined\nfor the app:",
        "Ensure that no consumers are currently running the version.",
        "Drop the version of the app you are replacing.",
        "Create a new version or patch for the changes in the application package.",
        "If the DISTRIBUTION property of the application package is set to EXTERNAL, the\nautomated security scan is initiated.\nThe security scan must pass before the upgrade can occur.",
        "Test the new version by creating installing the app in your test account.",
        "Update the release directive for the version or patch.",
        "This initiates an automated upgrade that will update all installed instances of the previous version.\nA provider can notify the consumer that an upgrade is available and ask them to\nmanually upgrade the app.",
        "The upgrade process starts automatically when a provider updates the release directive (default or custom) of the\napplication package to point to a new version or patch. Use the\nALTER APPLICATION PACKAGE \u2026 RELEASE DIRECTIVE command to set the release directive as shown\nin the following examples:",
        "This command sets the default release directive to version v2 and patch 0.",
        "This command sets the custom release directive named my_custom_release_directive to version v2 and patch 0\nfor the account USER_ACCOUNT.snowflakecomputing.com.",
        "See Set the release directive for an app for more information.",
        "Manual upgrades allow a consumer to upgrade their installed app faster than automated upgrades.\nWhen a new version or patch is available, a provider can ask the consumer to perform\na manual upgrade.",
        "The consumer performs a manual upgrade by running the ALTER APPLICATION.\nThis command initiate the upgrade of an installed version or patch of an app using the release directive\nspecified in the application package.",
        "To upgrade an installed Snowflake Native App to the latest available version, a consumer can use the UPGRADE clause of\nthe ALTER APPLICATION command to modify the application object:",
        "After upgrading an app, changes to the installed Snowflake Native App in the consumer account\nmight not be visible until the refresh to remote regions is performed.",
        "You can use the APPLICATION_STATE view in the Data Sharing Usage schema to\nmonitor the state. If the upgrade is not complete more than one day after the first refresh following the upgrade, there might be an issue\nwith the refresh process. Contact Snowflake Support.",
        "If a provider publishes a Snowflake Native App using\nCross-Cloud Auto-Fulfillment,\nautomated upgrades may take a while to upgrade depending on multiple factors, including:",
        "The value of the refresh schedule.",
        "The number of installed instances of the app.",
        "The number of regions where the app is deployed.",
        "If the upgrade contains an urgent fix that needs to be upgraded in a remote region, the provider can reduce the refresh\nfrequency of the listing to a smaller value. See\nMonitoring and managing auto-fulfillment settings\nfor information on setting the account-level refresh frequency.",
        "Caution",
        "Reducing the refresh frequency can increase the costs associated with replication.",
        "During the upgrade process, the app passes through different states. The following diagram shows the possible\nstates when upgrading from the previous version, v1, to a new version, v2.",
        "Note",
        "Although this diagram shows an upgrade for a version, it also applies to patch upgrades.",
        "The following table shows each stage of the upgrade process for an app within the same region that the application\npackage is located:",
        "Stage",
        "Description",
        "1",
        "App is disabled?",
        "If the app is disabled, no upgrade is possible.",
        "2",
        "Set release directive to v2.0",
        "The provider sets the release directive to v2.0.",
        "3",
        "Eligible to upgrade",
        "Snowflake performs checks to verify that the app is eligible to upgrade. These checks include verifying that\nthe app is not disabled, that application package is available, that the version and patch is valid for upgrade,\nthe consumer account is valid, etc.",
        "4",
        "Obtain upgrade slot?",
        "Depending on the number of apps being upgraded, the number of consumer accounts, etc. they may have to\nwait to begin the upgrade process.",
        "5",
        "Setup script run successfully?",
        "When the upgrade begins, Snowflake runs setup script. If any uncaught errors occur, the setup script execution stops.\nSnowflake queues the app for upgrade again based on the number of retries configured.",
        "6",
        "Is version updated?",
        "Snowflake checks to see if the upgrade is for a version or patch. If the upgrade is for a version,\nSnowflake performs additional checks and waits until all jobs from the older version of the app have completed.",
        "The following table shows the upgrade process for apps that are deployed to remote regions:",
        "Stage",
        "Description",
        "7",
        "Release directive v2.0 replicated in remote region",
        "When a provider sets the release directive for an app that is deployed to a remote region, the release\ndirective is propagated to the application package deployed in the remote region.",
        "8",
        "Active region for v2.0?",
        "When most of the apps in the primary region have been upgraded, Snowflake sends messages to the remote\nregion to begin the app upgrade.",
        "9",
        "Begin upgrade process",
        "Begin upgrade process for the app as described in the previous table.",
        "The following table describes each of the possible states of the upgrade process:",
        "State",
        "Description",
        "DISABLED",
        "The app is disabled and not eligible for upgrade.",
        "QUEUED",
        "The app is in the queue to be upgraded based on the number of apps and consumer accounts.",
        "UPGRADING",
        "The app is in the process of being upgraded.",
        "COMPLETED",
        "The app has upgraded successfully.",
        "QUEUED_RETRY",
        "The setup script or other check failed and the app is returned to the upgrade queue.",
        "FAILED",
        "The app upgrade failed. Upgrades can fail on the provider side, for example due to an error in the\nsetup script. Upgrades can also fail on the consumer side if the app is disabled, the consumer\naccount is inactive, etc.",
        "To view the upgrade state of an app, use the APPLICATION_STATE view.",
        "For example, in a situation where you updated the default release directive and want to see if all apps have\nreached the target version. To find application instances that have not yet finished the upgrade, use the query in\nthe following example:",
        "This view includes columns that are specific to upgrades, including the upgrade state and the region where\nthe app is deployed. For information on upgrade states see Upgrade states.",
        "The Snowflake Native App Framework provides several ways to troubleshoot the upgrade:",
        "Consumers can use the DESCRIBE APPLICATION command to view error messages related to\nfailed upgrades. This command provides insight into the errors that occurred during the upgrade process.",
        "Providers can use the APPLICATION_STATE view to view error messages for failed upgrades.\nUsing this view, providers can diagnose issues with specific applications. See Monitor the state of an upgrade\nfor more information.",
        "If logging and event tracing is configured for the\napp, providers can query the event table to diagnose problems with the app upgrade.",
        "See View the logs and events in the event table for more information.",
        "To view information about the status of a compute pool or service within an app,\nconsumers can use the following system functions:",
        "SYSTEM$GET_COMPUTE_POOL_STATUS",
        "SYSTEM$GET_SERVICE_LOGS",
        "Consumers can share this information back to providers. Providers can also configure event sharing\nto return this information.",
        "When an app installed in the consumer account is disabled, it is no longer usable.\nAn app installed in a consumer account can become disabled for multiple reasons, including:",
        "Problems with the application package",
        "Problems with the installed application",
        "Problems with the consumer account",
        "Both providers and consumers should avoid situations where an app remains disabled for an extended\nperiod of time. Disabled apps can become unusable and must be reinstalled",
        "Disabled apps are not part of the normal upgrade process and cannot be upgraded. If a disabled app becomes reenabled,\nit is automatically upgrade to the version and patch of the release directive. However, if the version or patch is no\nlonger available the app cannot be upgraded and must be reinstalled.",
        "For example, if a disabled app is on version v1, but the current and previous versions in the application package\nare v2 and v3, the app cannot be upgraded and is unusable.",
        "You can view the DISABLEMENT_REASONS column of the APPLICATION_STATE view\nto see the reasons an app is disabled. The following table lists the possible values for the DISABLEMENT_REASONS\ncolumn:",
        "Value",
        "Status description",
        "Is recoverable?",
        "MANUALLY_DISABLED",
        "The app is disabled by Snowflake",
        "Yes. To re-enable the app, contact Snowflake Support.",
        "ACCOUNT_INACTIVE",
        "The account becomes inactive by being locked or suspended causing the app to be unavailable.\nIn this state a consumer cannot execute any SQL queries in their account and the app cannot be upgraded.",
        "Yes. The app is automatically re-enabled if the account lock or suspension is removed",
        "PACKAGE_VERSION_IS_MISSING",
        "The application package version for the app was dropped by the provider. The app is no longer usable\nand must be dropped and reinstalled from a valid listing or application package",
        "No\nthe same name.",
        "CMK_ACCESS_DENIED",
        "The consumer manages the encryption key themselves (ENCRYPT_USE_CMK_KMS is enabled) and\nSnowflake doesn\u2019t have access to this key.",
        "Yes. To re-enable the app, ensure that the cloud provider configuration to retrieve the CMK is correct\nand that Snowflake has access to the key.",
        "LISTING_ACCESS_REVOKED",
        "The listing used to create the app is no longer available. Possible reasons for this status include:",
        "The provider deleted the listing",
        "The provider manually removed access to the private listing from the consumer account",
        "Possibly. Recoverability depends on the reason why access was revoked.",
        "For example, if the listing was deleted it is not recoverable. If a consumer account was\nmanually removed from the private listing, access to the listing and app can be restored.",
        "LISTING_TRIAL_USAGE_EXCEEDED",
        "The application has exceeded the usage limit for a usage-based trial listing.",
        "No",
        "LISTING_PAYMENT_REQUIRED",
        "The listing used to install the app is a paid listing and requires payment for further\nusage.",
        "Yes. The consumer must correctly set up payment for the app.",
        "LISTING_TRIAL_TIME_EXCEEDED",
        "The application exceeded the trial duration.",
        "No",
        "APPLICATION_PACKAGE_NOT_AVAILABLE",
        "The application package used to create the app no longer exists. The provider may have\ndropped the corresponding application package.",
        "No",
        "APPLICATION_PACKAGE_DISABLED",
        "The application package used to create the app is disabled by the Snowflake.",
        "Yes. The app is re-enabled, if Snowflake re-enables the application package.",
        "APPLICATION_SUSPENDED",
        "The app resources for example, tasks, services, and compute pools, are suspended due to\nthe app being disabled.",
        "The suspended objects remain suspended until the app is re-enabled and there are no other\nreasons the app was disabled.",
        "Yes",
        "APPLICATION_SUSPEND_RESUME_IN_PROGRESS",
        "The app resources, for example tasks, services, and compute pools, are currently resuming.",
        "Yes",
        "Was this page helpful?",
        "On this page",
        "Related content"
    ]
}