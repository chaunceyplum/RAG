{
    "url": "https://docs.snowflake.com/en/user-guide/data-load-snowpipe-rest-lambda",
    "title": "Option 2: Automating Snowpipe with AWS Lambda | Snowflake Documentation",
    "paragraphs": [
        "AWS Lambda is a compute service that runs when triggered by an event and executes code that has been loaded into the system. You can adapt the sample Python code provided in this topic and create a Lambda\nfunction that calls the Snowpipe REST API to load data from your external stage (i.e. S3 bucket; Azure containers are not supported). The function is deployed to your AWS account, where it is hosted. Events\nyou define in Lambda (e.g. when files in your S3 bucket are updated) invoke the Lambda function and run the Python code.",
        "This topic describes the steps necessary to configure a Lambda function to automatically load data in micro-batches continuously using Snowpipe.",
        "Note",
        "This topic assumes you have configured Snowpipe using the instructions in Preparing to load data using the Snowpipe REST API.",
        "Sample Python code",
        "Note",
        "The sample code does not account for error handling. For example, it does not retry failed ingest_manager calls.",
        "Before using the sample code, make the following changes:",
        "Update the security parameter:",
        "Specifies the content of the private key file you created in Using key pair authentication & key rotation (in Preparing to load data using the Snowpipe REST API).",
        "Specify the passphrase for decrypting the private key file using the PRIVATE_KEY_PASSPHRASE environment variable:",
        "Linux or macOS:",
        "Windows:",
        "Update the session parameters:",
        "Specify the unique identifier for your account (provided by Snowflake). See the host description.",
        "Specify the unique hostname for your Snowflake account.",
        "The preferred format of the account identifier is as follows:",
        "Names of your Snowflake organization and account. For details, see Format 1 (preferred): Account name in your organization.",
        "Alternatively, specify your account locator, along with the region and cloud platform where the account is hosted, if required. For details, see Format 2: Account locator in a region.",
        "Specifies the login name of the Snowflake user that will run the Snowpipe code.",
        "Specifies the fully-qualified name of the pipe to use to load the data, in the form of <db_name>.<schema_name>.<pipe_name>.",
        "Specify the path to your files to import in the file objects list:",
        "The path you specify must be relative to the stage where the files are located. Include the complete name for each file, including the file extension. For example, a CSV file that is\ngzip-compressed might have the extension .csv.gz.",
        "Save the file in a convenient location.",
        "The remaining instructions in this topic assume the file name to be SnowpipeLamdbaCode.py.",
        "Complete the following instructions to build a Python runtime environment for Lambda and add the Snowpipe code you adapted in Step 1: Write Python Code Invoking the Snowpipe REST API (in this topic).\nFor more information about these steps, see the AWS Lambda deployment package documentation (see the instructions for\nPython).",
        "Important",
        "The scripts in the following steps are a representative example and assume that you are creating an AWS EC2 Linux instance based on an Amazon Machine Instance (AMI) that uses the YUM package manager, which depends on RPM. If you select a Debian-based Linux AMI, please update your scripts accordingly.",
        "Create an AWS EC2 Linux instance by completing the AWS EC2 instructions. This instance will provide the\ncompute resources to run the Snowpipe code.",
        "Copy the Snowpipe code file to your new AWS EC2 instance using SCP (Secure Copy):",
        "Where:",
        "<path> is the path to your local SnowpipeLambdaCode.py file.",
        "<machine>.<region_id> is the DNS name of the EC2 instance (e.g. ec2-54-244-54-199.us-west-2.compute.amazonaws.com).",
        "The DNS name is displayed on the Instances screen in the Amazon EC2 console.",
        "Connect to the EC2 instance using SSH (Secure SHell):",
        "Install Python and related libraries on the EC2 instance:",
        "Create the .zip deployment package (Snowpipe.zip):",
        "Follow the AWS Lambda documentation to create an IAM role to execute the Lambda function.",
        "Record the IAM Amazon Resource Name (ARN) for the role. You will use it in the next step.",
        "Create the Lambda function by uploading the .zip deployment package you created in Step 2: Create a Lambda Function Deployment Package (in this topic):",
        "For --role, specify the role ARN you recorded in Step 3: Create an AWS IAM Role for Lambda  (in this topic).",
        "Record the ARN for the new function from the output. You will use it in the next step.",
        "Grant S3 the permissions required to invoke your function.",
        "For --source-arn, specify the function ARN you recorded in Step 4: Create the Lambda Function (in this topic).",
        "Register a Lambda notification event by completing the Amazon S3 Event Notifications instructions. In the input field, specify the\nfunction ARN you recorded in Step 4: Create the Lambda Function (in this topic).",
        "Was this page helpful?",
        "On this page"
    ]
}