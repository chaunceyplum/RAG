{
    "url": "https://docs.snowflake.com/en/sql-reference/external-functions-creating-aws-troubleshooting",
    "title": "Troubleshooting external functions for AWS | Snowflake Documentation",
    "paragraphs": [
        "This topic provides troubleshooting information for external functions for AWS.",
        "When passing arguments to or from an external function, ensure that the data types are appropriate. If the value\nsent can\u2019t fit into the data type being received, the value might be truncated or corrupted in some other way.",
        "For more details, see Ensure that arguments to the external function correspond to arguments parsed by the remote service.",
        "The row numbers you return within each batch should be monotonically ascending integers starting at 0. The input row numbers must also\nfollow this rule, and each output row should match the corresponding input row. For example, the output in output row 0 should\ncorrespond to the input in input row 0.",
        "Ensure that the row numbers you return are the same as the row numbers you received, and that each output value uses the row number of\nthe corresponding input. If this doesn\u2019t work, then the input row numbers may not be correct or you did not return the rows in the\ncorrect order.",
        "Next, ensure that the output row numbers start from 0, increase by 1, and are in order.",
        "For more information about data input and output formats, see Remote service input and output data formats.",
        "The most likely cause is that the JSON returned by the remote service (e.g. AWS Lambda function) is not constructed correctly.",
        "Ensure that the external function returns an array of arrays, with one inner array returned for each input row received. Review the\ndescription of the output format at Data format received by Snowflake.",
        "Your return value includes double quotes inside the value.",
        "Although JSON strings are delimited by double quotes, the string itself should not start and end with a quotation mark in most cases.\nIf the embedded double quotes are incorrect, remove them.",
        "The remote service tried to return more or fewer rows than it received. Even though the function is nominally scalar, it might receive\nmultiple rows in the body field of the event parameter, and should return exactly as many rows as it received.",
        "Ensure that the remote service returns one row for each row that it receives.",
        "The Lambda function might have:",
        "Timed out.",
        "Thrown an exception.",
        "Failed in some other way.",
        "If the Lambda or API Gateway logs, are available to you, examine them.",
        "If the source code of the Lambda function is available to you, then analyze and debug the code in the\nLambda function. In some cases, you might be able to execute a copy of that code in a simpler context\n(outside AWS) to help debug it.",
        "Verify that the data sent to the Lambda function is in the format that Lambda function expects.\nYou might want to try sending a smaller, simpler data set to see whether that succeeds.",
        "Verify that you are not sending too much data at a time.",
        "In some cases, increasing the timeout might solve the problem, especially if the Lambda function requires a\nlot of CPU resources, or if the Lambda function itself calls other remote services and thus requires more time.",
        "You might not have enabled Lambda proxy integration.",
        "Enable Lambda proxy integration.",
        "For more details, see the steps in Create the API Gateway endpoint.",
        "The full text of the message is:",
        "In the AWS Trust Relationship Policy for your role, the AWS ARN is incorrect. Possible causes of that include:",
        "You did not set it.",
        "You set it, but you used the ARN of the AWS role (incorrect) instead of the user ARN, which you\ncan see from the DESCRIBE INTEGRATION command in Snowflake. Make sure that you use the value from the\nAPI_AWS_IAM_USER_ARN field of the worksheet rather than the value from the \u201cAPI_AWS_ROLE_ARN\u201d field.",
        "In your AWS Trust Relationship Policy, the std:ExternalId is incorrect. Possible causes of that\ninclude:",
        "You did not set it.",
        "You re-created the API integration object. Re-creating the API object changes its external ID.",
        "The full text of the message is:",
        "The API Gateway resource policy has:",
        "The wrong IAM Role ARN.",
        "The wrong assumed role.",
        "The wrong Method Request ARN.",
        "The IAM role doesn\u2019t have the right policy attached.",
        "Make sure that you followed the resource policy template in\nSecure your Amazon API Gateway endpoint. Specifically, make sure that your resource policy:",
        "Replaced the <12-digit number> with the value in the worksheet field named Your AWS account ID.",
        "Replaced the <external_function_role> with the value in the New IAM Role Name field of the\nworksheet.",
        "Replaced the method_request_ARN in the Resource field with the value in the\nMethod Request ARN field in the worksheet. Make sure there is no slash at the end.",
        "If you need to make sure that the IAM role has the correct permissions policy attached, you can find the\nrole\u2019s permissions policy list by following the steps below:",
        "In AWS, go to Identity and Access Management (IAM) and select the role.",
        "View the Summary for the role.",
        "Click on the Permissions tab.",
        "Verify that the required policy is in the Permissions policies list.",
        "Make sure the endpoint being called is the resource, not the stage, that is set up on the API Gateway.",
        "The full text of the message is:",
        "One possible cause is that when you were configuring authorization for the API Gateway, you might not have\nspecified that the Method Request requires AWS_IAM authorization for the resource.",
        "If you did not follow the instructions in\nsecure the Amazon API Gateway, then please follow them\nnow to specify AWS_IAM authorization.",
        "The full text of the message is:",
        "You might not have specified Lambda proxy integration for the POST command in your API Gateway resource.",
        "Specify Lambda proxy integration for your API Gateway resource.",
        "For more details about Lambda proxy integration, see the steps in\nCreate the API Gateway endpoint.",
        "The proxy service required an API key, typically for\nauthentication or billing. The API key is missing or incorrect.",
        "Use the ALTER API INTEGRATION command to specify the correct API key.",
        "This error can occur if you are using an AWS CloudFormation template to create an external function.",
        "You do not have required permissions for creating the resources specified in the CloudFormation template.",
        "Check the Events tab for the stack to see the error details.",
        "Also look at the AWS external functions\ntroubleshooting page for additional\ntroubleshooting tips.",
        "Was this page helpful?",
        "On this page"
    ]
}