{
    "url": "https://docs.snowflake.com/en/sql-reference/external-functions-creating-azure-template-private-connect",
    "title": "Private connectivity with external functions: Azure ARM template | Snowflake Documentation",
    "paragraphs": [
        "Business Critical Feature",
        "This feature requires Business Critical (or higher). It is not available in government regions.",
        "To inquire about upgrading, please contact Snowflake Support.",
        "This topic provides configuration details to set up private connectivity to an external service by calling an external function for\nSnowflake accounts on Microsoft Azure. You can use the ARM template to configure resources in Microsoft Azure. Afterward, you can create an API integration\nand external function in Snowflake. Finally, you can call the external function to validate private connectivity to the external service.",
        "You pay for each private connectivity endpoint along with total data processed. For pricing of these items, see the Snowflake Service Consumption Table.",
        "You can explore the cost of these items by filtering on the following service types when querying billing views in the ACCOUNT_USAGE and ORGANIZATION_USAGE schemas:",
        "OUTBOUND_PRIVATELINK_ENDPOINT",
        "OUTBOUND_PRIVATELINK_DATA_PROCESSED",
        "For example, you can query the USAGE_IN_CURRENCY_DAILY view and filter on these service types.",
        "The following is a general overview of the configuration process. Steps in Snowflake must be done by a user with the ACCOUNTADMIN role.\nSteps in Azure are done by a user with rights to use the corresponding resources unless otherwise specified.",
        "The following steps are the same as using external functions with the public Internet:",
        "Complete the prerequisite steps for external functions on Microsoft Azure.",
        "In the Azure Portal, create an application.",
        "In the Azure Portal, create the remote service.",
        "However, you might want to create new resources to fully differentiate your private connectivity needs from your public Internet needs.\nConsult with your internal security administrators to determine the best approach for your needs.",
        "These steps are unique to external functions that use private connectivity for an external service:",
        "In Snowflake, create a private endpoint.",
        "In the Azure Portal, approve the private endpoint.",
        "This action is done by the owner of the Azure API Management resource.",
        "In Snowflake, create a new API integration.",
        "You need a dedicated API integration to support private connectivity to the external service.",
        "In Snowflake, create an external function. Use the private connectivity URL as the invocation URL in the external function.",
        "In Snowflake, call the external function to enable Snowflake to connect to the external service using private connectivity.",
        "Complete these steps in the Azure Portal:",
        "If you already have an ARM template set up and you want to reuse the remote service and proxy service, skip to the private\nconnectivity steps. Otherwise, complete these steps:",
        "Complete the prerequisites for external functions on Microsoft\nAzure.",
        "In the Azure Portal, create an application.",
        "Create the remote service as follows:",
        "In the Azure Portal, search for Deploy a custom template.",
        "In the Select a template tab, select Build your own template.",
        "Select Load file.",
        "Navigate to the directory on the machine where you downloaded the template and select that template.",
        "Select Save. This takes you to the Custom deployment screen.",
        "Continue with these steps:",
        "Create the Azure function and API Management service.",
        "Obtain the required URLs for the API integration and external function.",
        "Complete these steps to configure private connectivity:",
        "In Snowflake, run the CREATE API INTEGRATION command to create a new API integration to support private\nconnectivity to the external service. Update the property values to align with your Microsoft Azure subscription:",
        "In Snowflake, call the SYSTEM$PROVISION_PRIVATELINK_ENDPOINT system function to create the private\nendpoint. Update the argument values to align with your Microsoft Azure subscription:",
        "In the Azure Portal and as the owner of the Azure API Management resource, approve the private endpoint. For details, see the approval\nprocess.",
        "Link the API Integration for Azure to the proxy service to enable Snowflake to send API requests to the Azure API Management\nservice.",
        "You can choose to block public access to the Azure API Management resource. For more information, see\nSecure access to the Azure API Management resource (in this topic).",
        "In Snowflake, if you already have a database and schema to store the external function and want to use these objects, be sure these\nobjects are in use or select them in Snowsight. Otherwise, create a database and schema to\nstore the external the external function for use with private connectivity to an external service:",
        "In Snowflake, run the CREATE EXTERNAL FUNCTION command to create the external function to use with\nprivate connectivity to the external service. Be sure to update the invocation URL with the external service private connectivity URL:",
        "The URL format depends on whether you are creating an external function using the Azure Portal or the Azure ARM template. For\ndetails, see invocation URL format.",
        "In Snowflake, call the external function to test private connectivity to the external service:",
        "If the output of the function returns the result that matches the configuration of the remote service at the beginning of the procedure,\nthen you confirmed that private connectivity to the external service is working as expected.",
        "You can secure the access to the Azure API Management resource that is associated with the private endpoint for use with external functions.\nFrom the perspective of the Azure API Management resource, Snowflake is an inbound connection. By securing the access, you reduce the\nlikelihood of attacks that might compromise your use of external functions.",
        "For example, you might want to run this Azure CLI\napim command to block public access:",
        "Update the placeholder values with the values that correspond to the name of the API Management resource and the name of the resource group.",
        "For details and options, see these topics:",
        "Use a virtual network to secure inbound and outbound traffic for Azure API Management.",
        "Connect privately to API Management using an inbound private endpoint.",
        "Was this page helpful?",
        "On this page",
        "Related content"
    ]
}