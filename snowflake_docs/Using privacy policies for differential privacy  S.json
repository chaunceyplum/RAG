{
    "url": "https://docs.snowflake.com/en/user-guide/diff-privacy/differential-privacy-admin-privacy-policies",
    "title": "Using privacy policies for differential privacy | Snowflake Documentation",
    "paragraphs": [
        "Enterprise Edition Feature",
        "This feature requires Enterprise Edition (or higher). To inquire about upgrading, please contact Snowflake Support.",
        "This topic describes how a data provider uses privacy policies to implement\ndifferential privacy.",
        "With differential privacy, Snowflake must check each query to determine whether it will exceed the\nprivacy budget associated with the user executing the query. Privacy policies make that possible.\nA data provider creates a privacy policy that associates users with privacy budgets, and then assigns that policy to tables and views to\nmake them privacy-protected.",
        "When an analyst executes a query against a table with a privacy policy, Snowflake evaluates the body of the policy and does one of the\nfollowing:",
        "If the policy associates the user with a privacy budget, Snowflake makes sure that the\nprivacy loss incurred by the query does not exceed that privacy budget. If the query is executed\nsuccessfully, Snowflake adds the privacy loss incurred by the query to the cumulative privacy loss for the user so that subsequent queries\ndon\u2019t exceed the privacy budget.",
        "If the policy indicates that the user can query the table without restriction, then the results don\u2019t contain\nnoise, and Snowflake does not track the privacy loss incurred by the query.",
        "You can create a single privacy policy to protect a single entity, and then assign the privacy policy to all tables and views that contain\ninformation for that entity. This groups all privacy budgets for that entity under one privacy policy. You don\u2019t need to create separate\nprivacy policies for every table and view.",
        "Implementing differential privacy for a schema is a three-step process:",
        "Create a privacy policy that associates privacy budgets with users based on conditions like\nname, role, or account.",
        "Assign that privacy policy to a table or view to ensure that a query or set of queries against\nthe data don\u2019t exceed the privacy budget associated with the user who is executing the query.",
        "Grant SELECT privileges on the privacy-protected data. Don\u2019t grant privileges before assigning a privacy policy to the table or view\nbecause the analyst would have full access to the data.",
        "As you manage your differential privacy environment, you can also:",
        "Modify an existing privacy policy.",
        "Replace a privacy policy that is currently assigned to a table or view with another policy.",
        "Detach a privacy policy from a table or view.",
        "The most basic syntax for creating a new privacy policy is:",
        "Where:",
        "name is the name of the privacy policy.",
        "AS ( ) RETURNS PRIVACY_BUDGET is the signature and return type of the policy. The signature doesn\u2019t accept any arguments\nand the return type is PRIVACY_BUDGET, which is an internal data type. All privacy policies have the same signature and return\ntype.",
        "body is a SQL expression that determines whether the privacy policy returns a privacy budget, and if it does, which one.",
        "The SQL expression of the body calls two functions to control the return value of the policy:",
        "Use the body\u2019s expression to call the NO_PRIVACY_POLICY function when you want a query to have unrestricted access to the table or view\nto which the privacy policy is assigned.",
        "Use the body\u2019s expression to call the PRIVACY_BUDGET function when you want to return a privacy budget from the policy.",
        "For the complete syntax for the NO_PRIVACY_POLICY and PRIVACY_BUDGET functions, see CREATE PRIVACY POLICY.",
        "Create a privacy policy my_priv_policy that always returns a privacy budget named analysts:",
        "Create a privacy policy my_priv_policy that gives admin  unrestricted access to the privacy-protected table or view while\nassociating all other users with the privacy budget analysts:",
        "Create a privacy policy my_priv_policy that does the following:",
        "Gives admin unrestricted access to the privacy-protected table or view.",
        "Associates the privacy budget analysts to users in the same account.",
        "Names the privacy budget associated with external account users so it can be easily identified. Privacy budgets are automatically\nnamespaced to a specific external account, but using a descriptive naming scheme can help manage the privacy budgets.",
        "You can include context functions in the body of a privacy policy so its behavior depends on the\ncontext in which the differentially private query is executed.",
        "You can use the following context functions in the body of a privacy policy:",
        "Context function",
        "Description",
        "CURRENT_ACCOUNT",
        "Returns the account locator in use for the user\u2019s current session.",
        "CURRENT_DATABASE",
        "Returns the database that contains the table that is protected by the privacy policy.",
        "CURRENT_ORGANIZATION_NAME",
        "Returns the name of the organization in use for user\u2019s the current session.",
        "CURRENT_ROLE",
        "Returns the name of the role in use for the current session.",
        "CURRENT_SCHEMA",
        "Returns the schema that contains the table that is protected by the privacy policy.",
        "CURRENT_USER",
        "Returns the name of the user executing the query.",
        "INVOKER_ROLE",
        "Returns the name of the executing role.",
        "INVOKER_SHARE",
        "Returns the name of the share that directly accessed the table or view where the INVOKER_SHARE function is invoked.",
        "Tip",
        "Context functions like CURRENT_USER return strings,\nso comparisons using them are case-sensitive. You can use LOWER to convert strings to all lowercase\nif you\u2019d like to do a case-insensitive comparison.",
        "Use the ALTER PRIVACY POLICY command to modify a privacy policy. You can rename the policy, change its body, or\nmodify a comment.",
        "For example, to replace the existing body of a privacy policy my_priv_policy with a new body that always returns a budget\nexternal_analysts, execute:",
        "A privacy policy can be applied to one or more tables or views to protect them with differential privacy. A table or view can have only one privacy policy assigned to it.",
        "Use the ADD PRIVACY POLICY clause of an ALTER TABLE or ALTER VIEW command to assign\na privacy policy to the table or view. The syntax is:",
        "Where:",
        "name specifies the name of the table or view.",
        "policy_name specifies the name of the privacy policy.",
        "column_name specifies the entity key for the table or view. The entity key is a\ncolumn that uniquely identifies an entity within the table or view.",
        "In most cases, you\u2019ll want to define an entity key in order to implement entity-level privacy, though you can use the NO ENTITY KEY clause\nto protect individual rows without considering whether data belonging to an entity could exist in multiple rows. For more information, see About entity-level privacy.",
        "For example, to assign the policy my_priv_policy to the table t1 where the entity key is the email column, execute:",
        "The recommended method of replacing a privacy policy or entity key is to use both the ADD and DROP clauses in the same ALTER TABLE or ALTER\nVIEW command. This allows you to atomically make the change because both operations take place in the same transaction, leaving no gap in\nprotection.",
        "To keep the same policy but change the entity key, you need to drop the policy, then add it again with the new entity key.",
        "For example, to assign a new privacy policy to a table that is already protected by a privacy policy:",
        "You can also detach the privacy policy from a table or view in one statement and then set a new policy\non the table or view in a different statement. If you choose this method, the table is not protected by a privacy policy in between\ndetaching one policy and assigning another. A query could potentially access sensitive data during this time if the users still have SELECT\nprivileges on the data.",
        "Use the DROP PRIVACY POLICY clause of an ALTER TABLE or ALTER VIEW command to detach a privacy policy from a table or\nview. After executing this command, the table or view is no longer privacy-protected. The syntax is:",
        "Where:",
        "name specifies the name of the table or view.",
        "policy_name specifies the name of the privacy policy.",
        "For example, to detach the privacy policy my_priv_policy from the finance.accounting.customers table:",
        "To help monitor the use of privacy policies, you can list all of the privacy policies in your account, determine which tables and views are\nprotected by a particular privacy policy, or list all policies currently assigned to a table or view.",
        "You can use the PRIVACY_POLICIES view in the Account Usage schema of the shared\nSNOWFLAKE database. This view is a catalog for all privacy policies in your Snowflake account. For example:",
        "The POLICY_REFERENCES Information Schema table function can identify which tables and views are protected by\nprivacy policies. There are two different syntax options:",
        "Return a row for each object (that is, table or view) that has the specified privacy policy set on it:",
        "Return a row for each policy assigned to the table named my_table. Use the POLICY_KIND column to identify which policies are privacy\npolicies.",
        "The following subsections provide information to help manage privacy policies.",
        "Snowflake supports the following privileges on the privacy policy object.",
        "The USAGE privilege on the parent database and schema are required to perform operations on any object in a schema.",
        "Privilege",
        "Usage",
        "APPLY",
        "Lets you assign a privacy policy to, or detach a privacy policy from, a table or view.",
        "OWNERSHIP",
        "Required to alter most properties of a privacy policy. Ownership of the privacy policy can be transferred, which grants full control\nover the privacy policy.",
        "Snowflake supports the following DDL to create and manage privacy policies.",
        "CREATE PRIVACY POLICY",
        "ALTER PRIVACY POLICY",
        "DESCRIBE PRIVACY POLICY",
        "DROP PRIVACY POLICY",
        "SHOW PRIVACY POLICIES",
        "The following table summarizes the relationship between privacy policy privileges and DDL operations.",
        "The USAGE privilege on the parent database and schema are required to perform operations on any object in a schema.",
        "Operation",
        "Privilege required",
        "Create privacy policy",
        "A role with the CREATE PRIVACY POLICY privilege in the same schema.",
        "Alter privacy policy",
        "The role with the OWNERSHIP privilege on the privacy policy.",
        "Describe privacy policy",
        "One of the following:",
        "A role with the global APPLY PRIVACY POLICY privilege.",
        "A role with the OWNERSHIP privilege on the privacy policy.",
        "A role with the APPLY privilege on the privacy policy.",
        "Drop privacy policy.",
        "A role with the OWNERSHIP privilege on the privacy policy.",
        "Show privacy policies.",
        "One of the following:",
        "A role with the USAGE privilege on the schema in which the privacy policy exists.",
        "A role with the APPLY PRIVACY POLICY on the account.",
        "Assign a privacy policy to, or detach a privacy policy from, a table or view.",
        "One of the following:",
        "A role with the APPLY PRIVACY POLICY privilege on the account.",
        "A role with the APPLY privilege on the privacy policy and the OWNERSHIP privilege on the table or view.",
        "Was this page helpful?",
        "On this page",
        "Related content"
    ]
}