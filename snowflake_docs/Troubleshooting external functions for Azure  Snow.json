{
    "url": "https://docs.snowflake.com/en/sql-reference/external-functions-creating-azure-troubleshooting",
    "title": "Troubleshooting external functions for Azure | Snowflake Documentation",
    "paragraphs": [
        "This topic provides troubleshooting information for external functions for Azure.",
        "When passing arguments to or from an external function, ensure that the data types are appropriate. If the value\nsent can\u2019t fit into the data type being received, the value might be truncated or corrupted in some other way.",
        "For more details, see Ensure that arguments to the external function correspond to arguments parsed by the remote service.",
        "The row numbers you return within each batch should be monotonically ascending integers starting at 0. The input row numbers must also\nfollow this rule, and each output row should match the corresponding input row. For example, the output in output row 0 should\ncorrespond to the input in input row 0.",
        "Ensure that the row numbers you return are the same as the row numbers you received, and that each output value uses the row number of\nthe corresponding input. If this doesn\u2019t work, then the input row numbers may not be correct or you did not return the rows in the\ncorrect order.",
        "Next, ensure that the output row numbers start from 0, increase by 1, and are in order.",
        "For more information about data input and output formats, see Remote service input and output data formats.",
        "The most likely cause is that the JSON returned by the remote service (e.g. AWS Lambda function) is not constructed correctly.",
        "Ensure that the external function returns an array of arrays, with one inner array returned for each input row received. Review the\ndescription of the output format at Data format received by Snowflake.",
        "Your return value includes double quotes inside the value.",
        "Although JSON strings are delimited by double quotes, the string itself should not start and end with a quotation mark in most cases.\nIf the embedded double quotes are incorrect, remove them.",
        "The remote service tried to return more or fewer rows than it received. Even though the function is nominally scalar, it might receive\nmultiple rows in the body field of the event parameter, and should return exactly as many rows as it received.",
        "Ensure that the remote service returns one row for each row that it receives.",
        "When creating your Azure Function, you may not be able to modify settings for the function under the\nAuthentication/Authorization menu.",
        "This problem can occur if all of the following are true:",
        "Your Azure Function is running on Linux rather than Microsoft Windows.",
        "You plan to use Azure AD authentication/authorization for your Azure Function.",
        "You are using Azure\u2019s \u201cconsumption\u201d pricing tier rather than the \u201cpremium\u201d pricing tier.",
        "Azure AD authentication is not available on the Linux Consumption plan for Azure Functions. You must use an App Service plan or\nPremium plan in order to authenticate with Azure AD.",
        "Recreate the Azure Function and specify that it will run on Microsoft Windows rather than Linux.",
        "Skip Azure AD authentication/authorization for the Azure Function; instead, perform the following tasks:",
        "Set a validate-JWT (JSON Web Token) Policy for the API Management instance as documented in\nStep 6: Create the Azure security policy for the proxy service in the Portal.",
        "Use IP address restrictions to limit the remote service to accept connections only from the API Management\nservice instance.",
        "If you choose this solution, you must create the Azure AD application manually. For details, see the Microsoft documentation:",
        "app registration .",
        "If you create the Azure AD application manually, record the Azure Function AD app registration name and\nthe Azure Function App AD Application ID in your tracking worksheet.",
        "Switch from consumption pricing to premium pricing or use an App Service plan. For more details, see the Microsoft documentation:",
        "configuring an authentication provider",
        "There are many possible causes of timeouts. On Azure, one of the possible causes is that the Azure Functions app was not written to scale\nproperly.",
        "Ensure that you are following the\nAzure guidelines for writing scalable functions .",
        "For more information about troubleshooting scalability and performance issues, see\nTroubleshooting scalability and performance issues .",
        "Try the following steps:",
        "Verify that the Snowflake service principal has access to your Azure AD tenant.",
        "Verify that the tenant ID and the Azure AD application ID are correct.",
        "Note that whitespace, including leading and trailing whitespace (e.g. blanks), is significant in ID fields. Check for incorrect\nleading or trailing whitespace.",
        "Full error message text:",
        "The API Management service\u2019s subscription requirement might be on.",
        "You might need to turn off the subscription requirement for the API Management service.",
        "The proxy service requires an API key (aka \u201csubscription key\u201d), typically for authentication\nor billing. However, no API key was supplied in the API_KEY clause of the CREATE API INTEGRATION command.",
        "Use the ALTER API INTEGRATION command to update the API integration with a valid API key.",
        "The proxy service requires an API key (aka \u201csubscription key\u201d), typically for authentication\nor billing. However, the API key supplied in the API_KEY clause of the CREATE API INTEGRATION command was not valid.",
        "Use the ALTER API INTEGRATION command to update the API integration with a valid API key.",
        "Full error message text:",
        "You might not have finished setting the security policy on the Azure API Management service. For example, you might have:",
        "Created, but not edited, the JWT (JSON Web Token).",
        "Omitted one or more of the required claims/values. For example, you might have specified the claim for Snowflake but not the",
        "remote service (Azure Function), or vice versa.",
        "You might have used an invalid open ID URL.",
        "Finish setting the security policy on the Azure API Management service. For example, review the JWT and verify that you included the\nrequired claims/values, including the claim for Snowflake and the claim for the remote service (Azure Function).",
        "Verify that you used a valid open ID URL.",
        "Full error message text:",
        "If you used the ARM template, you might not have updated the JWT (JSON Web Token) that the template created for you.",
        "Update the JWT as documented in Step 6: Update the Azure security policy for the proxy service in the Portal.",
        "You might have chosen the wrong option for your Azure AD app:",
        "Incorrect option:\nAccounts in any organizational directory (Any Azure AD directory - Multitenant) and personal Microsoft accounts (e.g. Skype, Xbox)",
        "Correct option: Accounts in this organizational directory only (Default Directory only - Single tenant)",
        "Was this page helpful?",
        "On this page"
    ]
}