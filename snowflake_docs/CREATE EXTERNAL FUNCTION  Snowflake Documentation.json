{
    "url": "https://docs.snowflake.com/en/sql-reference/sql/create-external-function",
    "title": "CREATE EXTERNAL FUNCTION | Snowflake Documentation",
    "paragraphs": [
        "Creates a new external function.",
        "This command supports the following variants:",
        "CREATE OR ALTER EXTERNAL FUNCTION: Creates an external function if it doesn\u2019t exist or alters an existing external function.",
        "ALTER FUNCTION , SHOW EXTERNAL FUNCTIONS ,\nDROP FUNCTION , DESCRIBE FUNCTION ,\nCREATE API INTEGRATION, CREATE OR ALTER <object>",
        "Preview Feature \u2014 Open",
        "Available to all accounts.",
        "Creates a new external function if it doesn\u2019t already exist, or transforms an existing external function into the\nfunction defined in the statement. A CREATE OR ALTER EXTERNAL FUNCTION statement follows the syntax rules of a\nCREATE EXTERNAL FUNCTION statement and has the same limitations as an ALTER FUNCTION\nstatement.",
        "Supported function alterations include changes to the following:",
        "API_INTEGRATION",
        "COMMENTS",
        "COMPRESSION",
        "CONTEXT_HEADERS",
        "HEADERS",
        "MAX_BATCH_ROWS",
        "RESPONSE_TRANSLATOR",
        "REQUEST_TRANSLATOR",
        "SECURE",
        "For more information, see CREATE OR ALTER EXTERNAL FUNCTION usage notes.",
        "Specifies the identifier for the function.",
        "The identifier can contain the schema name and database name, as well as the function name.",
        "The identifier does not need to be unique for the schema in which the function is created because functions are\nidentified and resolved by their name and argument types. However, the signature (name and argument data types)\nmust be unique within the schema.",
        "The name must follow the rules for Snowflake identifiers.\nFor more details, see Identifier requirements.",
        "Setting name the same as the remote service name can make the relationship more clear.\nHowever, this is not required.",
        "Specifies the arguments/inputs for the external function. These should correspond to the arguments that the remote\nservice expects.",
        "If there are no arguments, then include the parentheses without any argument name(s) and data type(s).",
        "Specifies the data type returned by the function.",
        "This is the name of the API integration object that should be used to authenticate the call to the proxy service.",
        "This is the invocation URL of the proxy service (e.g. API Gateway or API Management service) and resource through\nwhich Snowflake calls the remote service.",
        "Specifies that the function is secure. If a function is secure, the URL, the HTTP headers, and the context headers\nare hidden from all users who are not owners of the function.",
        "This clause indicates whether the function can return NULL values or must return only NON-NULL values.\nIf NOT NULL is specified, the function must return only non-NULL values. If NULL is specified, the\nfunction can return NULL values.",
        "Default: The default is NULL (i.e. the function can return NULL values).",
        "Specifies the behavior of the function when called with null inputs. In contrast to system-defined functions,\nwhich always return null when any input is null, external functions can handle null inputs,\nreturning non-null values even when an input is null:",
        "CALLED ON NULL INPUT will always call the function with null inputs. It is up to the function to\nhandle such values appropriately.",
        "RETURNS NULL ON NULL INPUT (or its synonym STRICT) will not call the function if any input\nis null. Instead, a null value will always be returned for that row. Note that the function might\nstill return null for non-null inputs.",
        "Default: CALLED ON NULL INPUT",
        "Specifies the behavior of the function when returning results:",
        "VOLATILE: The function can return different values for different rows, even for the same input (e.g.\ndue to non-determinism and statefulness).",
        "IMMUTABLE: The function always returns the same result when called with the same input.\nSnowflake does not check or guarantee this; the remote service must be designed to behave this way.\nSpecifying IMMUTABLE for a function that actually returns different values for the same input will\nresult in undefined behavior.",
        "Default: VOLATILE",
        "Snowflake recommends that you set this explicitly rather than accept the default. Setting this\nexplicitly reduces the chance of error, and tells users how the function behaves.\n(The SHOW EXTERNAL FUNCTIONS command shows whether a function is volatile or immutable.)",
        "For important additional information about VOLATILE vs. IMMUTABLE external functions, see\nCategorize your function as volatile or immutable.",
        "Specifies a comment for the function, which is displayed in the DESCRIPTION column in the\nSHOW FUNCTIONS and SHOW EXTERNAL FUNCTIONS output.",
        "Default: user-defined function",
        "This clause allows users to specify key-value metadata that is sent with every request.\nThe creator of the external function decides what goes into the headers, and the caller does not have any control\nover it. Snowflake prepends all of the specified header names with the prefix \u201csf-custom-\u201d, and sends them as HTTP\nheaders.",
        "The value must be a constant string, not an expression.",
        "Here\u2019s an example:",
        "This causes Snowflake to add 2 HTTP headers into every HTTPS request:\nsf-custom-volume-measure and sf-custom-distance-measure, with their corresponding values.",
        "The rules for header names are different from the rules for Snowflake database identifiers. Header names can be\ncomposed of most visible standard ASCII characters (decimal 32 - 126) except the following:",
        "the space character",
        "(",
        ")",
        ",",
        "/",
        ":",
        ";",
        "<",
        ">",
        "=",
        "\"",
        "?",
        "@",
        "[",
        "]",
        "\\",
        "{",
        "}",
        "_",
        "Note specifically that the underscore character is not allowed in header names.",
        "The header name and value are delimited by single quotes, so any single quotes inside the header name or value\nmust be escaped with the backslash character.",
        "If the backslash character is used as a literal character inside a header value, it must be escaped.",
        "In header values, both spaces and tabs are allowed, but header values should not contain more than one whitespace\ncharacter in a row. This restriction applies to combinations of whitespace characters (e.g. a space followed by a\ntab) as well as individual whitespace characters (e.g. two spaces in a row).",
        "If the function author marks the function as secure (with CREATE SECURE EXTERNAL FUNCTION...), then the\nheaders, the context headers, the binary context headers, and the URL are not visible to function users.",
        "The sum of the sizes of the header names and header values for an external function must be less than or equal\nto 8 KB.",
        "This is similar to HEADERS, but instead of using constant strings, it binds Snowflake context function results to HTTP headers.\n(For more information about Snowflake context functions, see: Context functions.)",
        "Not all context functions are supported in context headers. The following are supported:",
        "CURRENT_ACCOUNT()",
        "CURRENT_CLIENT()",
        "CURRENT_DATABASE()",
        "CURRENT_DATE()",
        "CURRENT_IP_ADDRESS()",
        "CURRENT_REGION()",
        "CURRENT_ROLE()",
        "CURRENT_SCHEMA()",
        "CURRENT_SCHEMAS()",
        "CURRENT_SESSION()",
        "CURRENT_STATEMENT()",
        "CURRENT_TIME()",
        "CURRENT_TIMESTAMP()",
        "CURRENT_TRANSACTION()",
        "CURRENT_USER()",
        "CURRENT_VERSION()",
        "CURRENT_WAREHOUSE()",
        "LAST_QUERY_ID()",
        "LAST_TRANSACTION()",
        "LOCALTIME()",
        "LOCALTIMESTAMP()",
        "When function names are listed in the CONTEXT_HEADERS clause, the function names should not be quoted.",
        "Snowflake prepends sf-context to the header before it is written to the HTTP request.",
        "Example:",
        "In this example, Snowflake writes the header sf-context-current-timestamp into the HTTP request.",
        "The characters allowed in context header names and values are the same as the characters allowed in\ncustom header names and values.",
        "Context functions can generate characters that are illegal in HTTP header values, including (but not limited to):",
        "newline",
        "\u00c4",
        "\u00ce",
        "\u00df",
        "\u00eb",
        "\u00ac",
        "\u00b1",
        "\u00a9",
        "\u00ae",
        "Snowflake replaces each sequence of one or more illegal characters with one space character. (The replacement\nis per sequence, not per character.)",
        "For example, suppose that the context function CURRENT_STATEMENT() returns:",
        "The value sent in sf-context-current-statement is:",
        "To ensure that remote services can access the original result (with illegal characters) from the context function\neven if illegal characters have been replaced, Snowflake also sends a binary context header that contains the\ncontext function result encoded in base64.",
        "In the example above, the value sent in the base64 header is the result of calling:",
        "The remote service is responsible for decoding the base64 value if needed.",
        "Each such base64 header is named according to the following convention:",
        "In the example above, the name of the header would be",
        "If no context headers are sent, then no base64 context headers are sent.",
        "If the rows sent to an external function are split across multiple batches, then all batches contain the same\ncontext headers and the same binary context headers.",
        "This specifies the maximum number of rows in each batch sent to the proxy service.",
        "The purpose of this parameter is to limit batch sizes for remote services that have memory constraints or other\nlimitations. This parameter is not a performance tuning parameter. This parameter specifies a maximum\nsize, not a recommended size.",
        "If you do not specify MAX_BATCH_ROWS, Snowflake estimates the optimal batch size and uses that.",
        "Snowflake recommends leaving this parameter unset unless the remote service requires a limit.",
        "If this clause is specified, the JSON payload is compressed when sent from Snowflake to the proxy service, and when\nsent back from the proxy service to Snowflake.",
        "Valid values are:",
        "NONE.",
        "GZIP.",
        "DEFLATE.",
        "AUTO.",
        "On AWS, AUTO is equivalent to GZIP.",
        "On Azure, AUTO is equivalent to NONE.",
        "On GCP, AUTO is equivalent to NONE.",
        "The Amazon API Gateway automatically compresses/decompresses requests. For more information about\nAmazon API Gateway compression and decompression, see:\nhttps://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-gzip-compression-decompression.html",
        "For information about compression and decompression for other cloud platform proxy services, see the documentation\nfor those cloud platforms.",
        "Default: The default is AUTO.",
        "This specifies the name of the request translator function. For more information, see Using request and response translators with data for a remote service.",
        "This specifies the name of the response translator function. For more information, see Using request and response translators with data for a remote service.",
        "A role used to execute this SQL command must have the following\nprivileges at a minimum:",
        "Privilege",
        "Object",
        "Notes",
        "CREATE EXTERNAL FUNCTION",
        "Schema",
        "Operating on functions also requires the USAGE privilege on the parent database and schema.",
        "Either OWNERSHIP or USAGE",
        "API integration",
        "Required to create external functions that reference an API integration.",
        "For instructions on creating a custom role with a specified set of privileges, see Creating custom roles.",
        "For general information about roles and privilege grants for performing SQL actions on\nsecurable objects, see Overview of Access Control.",
        "When compression is used, Snowflake sets the HTTP headers \u201cContent-Encoding\u201d and \u201cAccept-Encoding\u201d.",
        "The argument type(s) and the return type cannot be GEOGRAPHY.",
        "Regarding metadata:",
        "Attention",
        "Customers should ensure that no personal data (other than for a User object), sensitive data, export-controlled data, or other regulated data is entered as metadata when using the Snowflake service. For more information, see Metadata fields in Snowflake.",
        "CREATE OR REPLACE <object> statements are atomic. That is, when an object is replaced, the old object is deleted and the new object is created in a single transaction.",
        "Preview Feature \u2014 Open",
        "Available to all accounts.",
        "Alterations to the function definition and its return type are not supported.",
        "The following example shows a CREATE EXTERNAL FUNCTION statement that is called through an Amazon API Gateway\nproxy service:",
        "In this example:",
        "local_echo is the name called from a SQL statement (for example, you can execute\nSELECT local_echo(varchar_column) ...;).",
        "string_col VARCHAR contains the name and data type of the input parameter(s). An external function can have 0 or more\ninput parameters.",
        "variant is the data type of the value returned by the external function.",
        "The name demonstration_external_api_integration_01 is the name of the API integration created earlier in a\nCREATE API INTEGRATION statement.",
        "The URL https://xyz.execute-api.us-west-2.amazonaws.com/prod/remote_echo is the string that identifies the proxy service and\nresource. An HTTP POST command is sent to this URL.",
        "Alter the external function local_echo created above to set the maximum number of batch rows to 100, compression\nto GZIP, and add heads and a context header:",
        "Was this page helpful?",
        "On this page"
    ]
}