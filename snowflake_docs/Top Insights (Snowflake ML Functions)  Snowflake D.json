{
    "url": "https://docs.snowflake.com/en/user-guide/ml-functions/top-insights",
    "title": "Top Insights (Snowflake ML Functions) | Snowflake Documentation",
    "paragraphs": [
        "Top Insights is an ML Function for key driver analysis, helping you to identify\ndrivers of a metric\u2019s change over time or explain differences in a metric among various verticals. Top Insights is\npowered by a decision tree model that separates a dataset into segments that have different behavior in relation to the\nmetric you want to analyze. With a few lines of SQL, you can integrate Top Insights into your BI workflows to\nautomatically monitor segments responsible for changes in any metric.",
        "Use cases for Top Insights include:",
        "Time-series analysis: Identify drivers of a metric\u2019s change over time. For example, automatically identify the\nlocations, salespeople, customers, verticals, and other factors that are responsible for a recent revenue shortfall.",
        "Vertical analysis: Identify the drivers of differences in a metric among various verticals. For example, to understand\nwhich user segments are responsible for differences in new user growth between the United States and EMEA countries,\nto help shape targeted marketing campaigns.",
        "Top Insights uses a decision tree model that separates a dataset into segments that have different behavior in relation\nto the metric you want to analyze. The algorithm analyzes inter-segment differences between the metric in the control\ngroup and the test group.",
        "The control group consists of the data points the model will use as a baseline.",
        "The test group consists of points of interest to be analyzed.",
        "Top Insights then produces a number of possible contributor combinations, which are filtered based on their significance\nand distinctiveness. Top Insights does not return redundant segments.",
        "Good candidate datasets for analysis with Top Insights typically have a large number of columns or dimensions used to\nsegment data that make it difficult to intuitively identify what segments influence a metric. Dimensions can be\ncategorical (location, market segment, etc.) or continuous (that is, quantitative, such as temperature or attendance).",
        "A Top Insights model is a schema-level object. You only need one instance, since the instance does not hold any state.",
        "Tip",
        "Dimensions are inferred as categorical or continuous based on their type. Numeric values are taken to be continuous\ndimensions, while string and boolean values are considered categorical. To use a numeric value as a categorical\ndimension, cast it to a string.",
        "A TOP_INSIGHTS instance is a schema-level object. Therefore, the role you use to create the instance must have the\nCREATE SNOWFLAKE.ML.TOP_INSIGHTS privilege on the schema where the instance is created. This privilege is similar to\nother schema privileges like CREATE TABLE or CREATE VIEW.",
        "If you are not the owner of the instance, you must have the USAGE privilege on it to be able to call its GET_DRIVERS\nmethod.",
        "To use Top Insights in your queries and pipelines, first create an instance of the TOP_INSIGHTS (SNOWFLAKE.ML)\nclass. The SQL statement below creates an instance named my_insights. Creating the instance does not require\nany arguments.",
        "After creating an instance, you can use the GET_DRIVERS method to extract key drivers from the dataset\nyou want to perform key driver analytics on. You pass the input data all in one piece (a\nreference to a single table, view, or query) and provide the names of the\nmetric and label columns within the input data as additional arguments. Categorical and continuous dimensions\nare inferred by their type and do not need to be specified explicitly.",
        "To use Top Insights, make sure you have a Boolean label column that distinguishes rows that are part of the control\ngroup (labeled FALSE) from rows in the test group (labeled TRUE). This column is usually derived from other values in\nthe dataset, such as a timestamp or the name of a vertical, so it is common to create a view to do this. The view is\nalso a good place to filter out columns that are not part of your analysis.",
        "The example below, for time-series analysis, creates a view with a label column based on a date range. Specifically, it\nlabels records in the latest month as TRUE (test data) and all previous records as FALSE (control data). Top\nInsights can then analyze the continuous and categorical dimensions that explain differences in month-to-month changes\nfor the specified metric.",
        "The following example, for vertical analysis, creates a view with a label column based on the country. Specifically, it\nlabels records in non-US countries as TRUE, and labels records in the USA as FALSE. Top Insights will then analyze the\ncontinuous and categorical dimensions that explain differences in a metric between these population groups.",
        "Top Insights returns a row for each segment of interest it finds in your data. Each row contains a plain-English\ndescription of the segment, which can contain multiple criteria (for example, \u201cCOUNTRY = france, not VERTICAL = fashion,\nnot VERTICAL = tech\u201d might describe a single segment). For each segment, Top Insights provides the following values\nwhich quantify how much the segment contributes to the changes between the control and the test group.",
        "Output column",
        "Description",
        "METRIC_CONTROL",
        "The total value of the metric in the control period in a specific segment.",
        "METRIC_TEST",
        "The total value of the metric in the test period in a specific segment.",
        "CONTRIBUTION",
        "The absolute impact of the segment on the change in the metric.",
        "RELATIVE_CONTRIBUTION",
        "The impact of the segment as a proportion of the overall change in the metric between test and control.",
        "GROWTH_RATE",
        "The change in the metric in the segment as a proportion of the metric in the control group in the segment.",
        "The contribution, relative contribution, and growth rate may be negative, indicating that a segment has a negative impact.",
        "Using Top Insights incurs compute costs. Execution time scales with the number of rows and dimensions processed. See\nUnderstanding compute cost for general information about Snowflake\ncompute costs.",
        "Top Insights performance does not generally benefit from using a larger warehouse than is needed to load all the data\nbeing analyzed, which must fit into memory. Datasets that surpass about 1,000,000 rows and 1,000 columns may exhaust\nmemory. Snowflake recommends using a Snowpark-optimized warehouse rather than a larger standard warehouse.\nSnowpark-optimized warehouses have more memory than standard warehouses of the corresponding size.",
        "While instances of the Top Insights class are schema-level objects, they do not store any data and have negligible\nimpact on storage costs.",
        "The following examples demonstrate how to use Top Insights for time-series analysis and vertical analysis.",
        "Time-series analysis example",
        "Vertical analysis example",
        "This example finds the segments contributing to differences in the metric between two time periods, specifically how\nthe country and vertical dimensions affect the metric after 2021.",
        "Create the input table containing synthetic data for this example using the following SQL statements.",
        "Create a view with a label column based on the datestamp.",
        "Now analyze this data by calling the GET_DRIVERS method of a TOP_INSIGHTS instance.",
        "The output resembles the following:",
        "Note",
        "Since the input data is randomly generated, your results will differ from the results above.",
        "The output is ordered by CONTRIBUTION, with the Overall segment always at the top. The CONTRIBUTOR column contains an\narray of strings describing the segment; the rest of the columns quantify how that segment contributes to the metric value.\nFor more details, see Interpreting the results.",
        "In the example output above, simply being in the United States has the largest impact on the metric. Two additional\nsegments, based on the finance and automotive verticals within the United States, also have outsize impact. After those,\nthe contribution of the segments turns negative.",
        "This example compares credit usage of companies in two regions, USA and EMEA, with a goal of understanding how credit\nusage in each segment differs between the regions.",
        "Create the input table containing synthetic data for this example using the following SQL statements.",
        "Create a view with a label column based on the region.",
        "Now analyze this data by calling the GET_DRIVERS method of a TOP_INSIGHTS instance.",
        "The output resembles the following:",
        "Note",
        "Since the input data is randomly generated, your results will differ from the results above.",
        "The output is ordered by CONTRIBUTION, with the Overall segment always at the top. The CONTRIBUTOR column contains an\narray of strings describing the segment; the rest of the columns describe how that segment contributes to the metric value.\nFor more details, see <instance_name>!GET_DRIVERS.",
        "In the example output above, you can see that the segments are based on the industry and the number of employees that\nthe customer has. Top Insights automatically selects such ranges for continuous dimensions. Customers of a certain size\n(between about 4,000 and 6,000 employees) seem to have an outsize negative impact.",
        "The input metric must be an individual observation or an aggregate.",
        "For categorical features having more than 25 values, Top Insights uses only the top 25 most influential values to create segments.",
        "Processing more than 100 million rows in a single job may exhaust memory, even with Snowpark-optimized warehouses.",
        "Important",
        "Legal notice. This Snowflake ML function is powered by machine learning technology. Machine\nlearning technology and results provided may be inaccurate, inappropriate, or biased. Decisions based on machine\nlearning outputs, including those built into automatic pipelines, should have human oversight and review processes\nto ensure model-generated content is accurate. Snowflake Cortex ML function queries will be treated as any\nother SQL query and may be considered metadata.",
        "Metadata. When you use Snowflake Cortex ML functions, Snowflake logs generic error messages returned by an ML\nfunction. These error logs help us troubleshoot issues that arise and improve these functions to serve you better.",
        "For further information, see Snowflake AI Trust and Safety FAQ.",
        "Was this page helpful?",
        "On this page",
        "Related content"
    ]
}