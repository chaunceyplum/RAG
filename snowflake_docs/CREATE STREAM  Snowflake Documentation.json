{
    "url": "https://docs.snowflake.com/en/sql-reference/sql/create-stream",
    "title": "CREATE STREAM | Snowflake Documentation",
    "paragraphs": [
        "Creates a new stream in the current/specified schema or replaces an existing stream. A stream records data\nmanipulation language (DML) changes made to a table, directory table, external table, or the underlying tables in a view (including\nsecure views). The object for which changes are recorded is called the source object.",
        "In addition, this command supports the following variant:",
        "CREATE STREAM \u2026 CLONE (creates a clone of an existing stream)",
        "ALTER STREAM , DROP STREAM , SHOW STREAMS , DESCRIBE STREAM",
        "The command syntax differs depending on the object on which the stream is created:",
        "CREATE STREAM \u2026 CLONE",
        "Creates a new stream with the same definition as the source stream. The clone inherits the current offset (i.e. the current\ntransactional table version) from the source stream.",
        "For more information about cloning, see CREATE <object> \u2026 CLONE.",
        "String that specifies the identifier (i.e. name) for the stream; must be unique for the schema in which the stream is created.",
        "In addition, the identifier must start with an alphabetic character and cannot contain spaces or special characters unless the entire\nidentifier string is enclosed in double quotes (e.g. \"My object\"). Identifiers enclosed in double quotes are also\ncase-sensitive.",
        "For more details, see Identifier requirements.",
        "String that specifies the identifier (i.e. name) for the table whose changes are tracked by the stream (i.e. the source table).",
        "To query a stream, a role must have the SELECT privilege on the underlying table.",
        "String that specifies the identifier (i.e. name) for the external table whose changes are tracked by the stream (i.e. the source\nexternal table).",
        "To query a stream, a role must have the SELECT privilege on the underlying external table.",
        "String that specifies the identifier (i.e. name) for the stage whose directory table changes are tracked by the stream (i.e. the\nsource directory table).",
        "To query a stream, a role must have the USAGE (external stage) or READ (internal stage) privilege on the underlying\nstage.",
        "String that specifies the identifier (i.e. name) for the source view. The stream tracks DML changes to the underlying tables in\nthe view.",
        "For more information about streams on views, see Streams on Views.",
        "To query a stream, a role must have the SELECT privilege on the view.",
        "Specifies the tag name and the tag string value.",
        "The tag value is always a string, and the maximum number of characters for the tag value is 256.",
        "For information about specifying tags in a statement, see Tag quotas for objects and columns.",
        "Specifies to retain the access permissions from the original stream when a new stream is created using any of the following\nCREATE STREAM variants:",
        "CREATE OR REPLACE STREAM",
        "CREATE STREAM \u2026 CLONE",
        "The parameter copies all permissions, except OWNERSHIP, from the existing stream to the new stream. By default, the role\nthat executes the CREATE STREAM command owns the new stream.",
        "Note",
        "If the CREATE STREAM statement references more than one stream (e.g. create or replace stream t1 clone t2;), the\nCOPY GRANTS clause gives precedence to the stream being replaced.",
        "The SHOW GRANTS output for the replacement stream lists the grantee for the copied privileges as the\nrole that executed the CREATE STREAM statement, with the current timestamp when the statement was executed.",
        "The operation to copy grants occurs atomically in the CREATE STREAM command (i.e. within the same transaction).",
        "Note",
        "This parameter is not supported currently.",
        "Creates a stream at a specific time/point in the past (using Time Travel). The\nAT | BEFORE clause determines the point in the past from which historical data is requested:",
        "The AT keyword specifies that the request is inclusive of any changes made by a statement or transaction with a timestamp\nequal to the specified parameter.",
        "The STREAM => '<name>' value is special. When provided, the CREATE STREAM statement creates the new stream at the same\noffset as the specified stream. You can also provide this value when recreating an existing stream (using the OR REPLACE\nkeywords) to retain the current offset of the stream after it is recreated. '<name>' is the identifier (i.e. name) for\nthe existing stream whose offset is copied to the new or recreated stream.",
        "The new or recreated stream advances the offset, as usual, when the stream is used in a DML transaction.",
        "The BEFORE keyword specifies that the request refers to a point immediately preceding the specified parameter.",
        "Note",
        "If no change tracking data is available on the source object at the point in the past specified in the AT | BEFORE clause, the\nCREATE STREAM statement fails. No stream can be created at a time in the past before change tracking was recorded.",
        "Only supported for streams on standard tables or streams on views that query standard tables.",
        "Specifies whether this is an append-only stream. Append-only streams track row inserts only. Update and delete operations (including\ntable truncates) are not recorded. For example, if 10 rows are inserted into a table and then 5 of those rows are deleted before the\noffset for an append-only stream is advanced, the stream records 10 rows.",
        "This type of stream improves query performance over standard streams and is very useful for extract, load, transform (ELT) and similar\nscenarios that depend exclusively on row inserts.",
        "A standard stream joins the deleted and inserted rows in the change set to determine which rows were deleted and which were updated.\nAn append-only stream returns the appended rows only and therefore can be much more performant than a standard stream. For example,\nthe source table can be truncated immediately after the rows in an append-only stream are consumed, and the record deletions do not\ncontribute to the overhead the next time the stream is queried or consumed.",
        "FALSE",
        "Required for streams on external tables. Not supported by streams on other objects.",
        "Specifies whether this is an insert-only stream. Insert-only streams track row inserts only; they do not record delete operations\nthat remove rows from an inserted set (i.e. no-ops). For example, in-between any two offsets, if File1 is removed from the\ncloud storage location referenced by the external table, and File2 is added, the stream returns records for the rows in\nFile2 only. Unlike when tracking change data capture (CDC) data for standard tables, Snowflake cannot access the historical\nrecords for files in cloud storage.",
        "FALSE",
        "Specifies the records to return the first time the stream is consumed.",
        "The stream returns only the rows that existed in the source object at the moment when the stream was created. The\nMETADATA$ISUPDATE column shows a FALSE value in these rows. Subsequently, the stream returns any DML changes to the source object\nsince the most recent offset; that is, the normal stream behavior.",
        "This parameter enables initializing any downstream process with the contents of the source object for the stream.",
        "FALSE",
        "The stream returns any DML changes to the source object since the most recent offset.",
        "FALSE",
        "String (literal) that specifies a comment for the stream.",
        "Default: No value",
        "The output for a stream includes the same columns as the source object along with the following additional columns:",
        "METADATA$ACTION: Specifies the action (INSERT or DELETE).",
        "METADATA$ISUPDATE: Specifies whether the action recorded (INSERT or DELETE) is part of an UPDATE applied to the rows in the source table\nor view.",
        "Note that streams record the differences between two offsets. If a row is added and then updated in the current offset, the delta change\nis a new row. The METADATA$ISUPDATE row records a FALSE value.",
        "METADATA$ROW_ID: Specifies the unique and immutable ID for the row, which can be used to track changes to specific rows over time.",
        "A role used to execute this SQL command must have the following\nprivileges at a minimum:",
        "Streams on standard tables:",
        "Object",
        "Privilege",
        "Notes",
        "Schema",
        "CREATE STREAM",
        "Table",
        "SELECT",
        "If change tracking has not been enabled on the source table (using\nALTER TABLE \u2026 SET CHANGE_TRACKING = TRUE), then only the table owner (i.e. the role\nthat has the OWNERSHIP privilege on the table) can create the initial stream on the table. Creating the initial stream automatically\nenables change tracking on the table.",
        "The USAGE privilege on the parent database and schema are required to perform operations on any object in a schema.",
        "Streams on views:",
        "Object",
        "Privilege",
        "Notes",
        "Schema",
        "CREATE STREAM",
        "View",
        "SELECT",
        "If change tracking has not been enabled on the source view and its underlying tables, then only a role that has the OWNERSHIP\nprivilege on the view and its underlying tables owner can create the initial stream on the view. Creating the initial stream\nautomatically enables change tracking on the table. For instructions on enabling change tracking on a view and its underlying\ntables, refer to Enabling Change Tracking on Views and Underlying Tables.  Note that enabling change tracking locks the underlying tables\nwhile change tracking is being enabled. Locks on the underlying objects may cause latency in DDL/DML operations with these objects.\nFor more information, refer to Resource locking.",
        "The USAGE privilege on the parent database and schema are required to perform operations on any object in a schema.",
        "Streams on directory tables:",
        "Object",
        "Privilege",
        "Notes",
        "Schema",
        "CREATE STREAM",
        "Stage",
        "USAGE (external stage) or READ (internal stage)",
        "The USAGE privilege on the parent database and schema are required to perform operations on any object in a schema.",
        "Streams on external tables:",
        "Object",
        "Privilege",
        "Notes",
        "Schema",
        "CREATE STREAM",
        "External table",
        "SELECT",
        "The USAGE privilege on the parent database and schema are required to perform operations on any object in a schema.",
        "For instructions on creating a custom role with a specified set of privileges, see Creating custom roles.",
        "For general information about roles and privilege grants for performing SQL actions on\nsecurable objects, see Overview of Access Control.",
        "A stream can be queried multiple times to update multiple objects in the same transaction and it will return the same data.",
        "The stream position (i.e. offset) is advanced when the stream is used in a DML statement. The position is updated at the end of the\ntransaction to the beginning timestamp of the transaction. The stream describes change records starting from the current position of the\nstream and ending at the current transactional timestamp.",
        "To ensure multiple statements access the same change records in the stream, surround them with an explicit transaction statement\n(BEGIN .. COMMIT). An explicit transaction locks the stream, so that DML updates to\nthe source object are not reported to the stream until the transaction is committed.",
        "Streams have no Fail-safe period or Time Travel retention period. The metadata in these objects cannot be recovered if a stream is dropped.",
        "Streams on shared tables:",
        "The retention period for a source table is not extended automatically to prevent any streams on the table from becoming stale.",
        "Standard streams cannot retrieve change data for geospatial data. We recommend creating append-only streams on objects that contain\ngeospatial data.",
        "Streams on views:",
        "Creating the first stream on a view using the view owner role (i.e. the role with the OWNERSHIP privilege on the view) enables change\ntracking on the view. If the same role also owns the underlying tables, change tracking is also enabled on the tables. If the role was\nnot granted the OWNERSHIP privilege on both the view and its underlying tables, then change tracking must be enabled manually on the\napplicable objects. For instructions, see Enabling Change Tracking on Views and Underlying Tables.",
        "Depending on the number of joins in a view, a single change in the underlying tables could result in a large number of changes in the\nstream output.",
        "Any stream on a given view breaks if the source view or underlying tables are dropped or recreated (using CREATE OR REPLACE VIEW).",
        "Any streams on a secure view adhere to the secure view constraints.",
        "If the owner of a non-secure view (i.e. the role with the OWNERSHIP privilege on the view) changes it to a secure view (using ALTER\nVIEW \u2026 SET SECURE), any stream on the view automatically enforces secure view constraints.",
        "In addition, the retention period for the underlying tables is not extended automatically to prevent any streams on the secure\nview from becoming stale.",
        "Streams based on views where the view uses non-deterministic functions can return non-deterministic results.",
        "For example, the results of context functions such as CURRENT_DATE,\nand CURRENT_USER are non-deterministic.  The results of data generation functions\nsuch as RANDOM are also non-deterministic.\nIf a view contains a non-deterministic function, then any stream on that view will not be a constant snapshot of the\nfunction\u2019s output. Instead the value in the stream may change when queried.",
        "We recommend that you ensure that the non-determinism in the results of a view does not\naffect the correctness of the stream query results.",
        "For an example, see Stream on a View That Calls a Non-deterministic SQL Function.",
        "Streams on directory tables: The METADATA$ROW_ID column values in the stream output are empty.",
        "Regarding metadata:",
        "Attention",
        "Customers should ensure that no personal data (other than for a User object), sensitive data, export-controlled data, or other regulated data is entered as metadata when using the Snowflake service. For more information, see Metadata fields in Snowflake.",
        "CREATE OR REPLACE <object> statements are atomic. That is, when an object is replaced, the old object is deleted and the new object is created in a single transaction.",
        "Create a stream on the mytable table:",
        "Create a stream on the mytable table as it existed before the date and time in the specified timestamp:",
        "Create a stream on the mytable table as it existed exactly at the date and time of the specified timestamp:",
        "Create a stream on the mytable table as it existed 5 minutes ago:",
        "Create a stream on the mytable table with the same offset as existing stream oldstream on the same source table:",
        "Recreate the existing mystream stream but retain its current offset:",
        "Create a stream on the mytable table including transactions up to, but not including any changes made by the specified transaction:",
        "Create a stream on the myview view:",
        "For additional examples, see Stream Examples.",
        "Create an external table stream and query the change data capture records in the stream, which track the records added to the external\ntable metadata:",
        "Create a stream on the directory table for a stage named mystage:",
        "Manually refresh the directory table metadata to populate the stream:",
        "Query the stream after one or more files were added to the stage after the most recent offset for the stream:",
        "Was this page helpful?",
        "On this page"
    ]
}