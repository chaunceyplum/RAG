{
    "url": "https://docs.snowflake.com/en/user-guide/key-pair-auth-troubleshooting",
    "title": "Key Pair Authentication: Troubleshooting | Snowflake Documentation",
    "paragraphs": [
        "This topic helps you troubleshoot errors that occur when connecting to Snowflake with\nkey pair authentication. It focuses on errors that contain JWT token is invalid.",
        "Before troubleshooting, you need to determine that the issue is resulting in a JWT token is invalid error.",
        "If your Snowflake client is a driver or connector that does not have an interactive interface, use logs to inspect connection errors:",
        "Enable logging for the Snowflake connector or driver. For details, see\nGenerate log files for Snowflake Drivers & Connectors (Snowflake Knowledge Base article).",
        "Check for errors that contain the string JWT token is invalid.",
        "For example, a client using the Snowflake JDBC driver might get the following error when trying to use key pair authentication:",
        "Each JWT token is invalid error includes a UUID that appears in brackets immediately after the error (for example,\nJWT token is invalid. [0ce9eb56-821d-4ca9-a774-04ae89a0cf5a]). You should provide the UUID of the error to a Snowflake administrator so\nthey can obtain more information about the error.",
        "Administrators use the SYSTEM$GET_LOGIN_FAILURE_DETAILS function to obtain additional details about the\nerror. For example, to obtain additional information about the error JWT token is invalid. [0ce9eb56-821d-4ca9-a774-04ae89a0cf5a],\na user with the ACCOUNTADIMN role can execute:",
        "The JSON_EXTRACT_PATH_TEXT function parses the JSON output of the SYSTEM$GET_LOGIN_FAILURE_DETAILS function to retrieve the error code and\nerror.",
        "The output of the SYSTEM$GET_LOGIN_FAILURE_DETAILS function is one of the following error code/error combinations.",
        "Error Code",
        "Error",
        "Description",
        "390144",
        "JWT_TOKEN_INVALID",
        "There is a general issue with the JWT token. For possible solutions, see Common Errors and Solutions.",
        "394300",
        "JWT_TOKEN_INVALID_USER_IN_ISSUER",
        "The user name specified in the issuer does not exist in the Snowflake account. For possible solutions, see Common Errors and Solutions.",
        "394301",
        "JWT_TOKEN_MISSING_ISSUE_OR_EXPIRATION_TIME",
        "The JWT token does not contain an issue time or an expiration time.",
        "394302",
        "JWT_TOKEN_INVALID_ISSUE_TIME",
        "The JWT token was received by Snowflake more than 60 seconds after the issue time. For possible solutions, see Common Errors and Solutions.",
        "394303",
        "JWT_TOKEN_INVALID_EXPIRATION_TIME",
        "The JWT token is expired.",
        "394304",
        "JWT_TOKEN_INVALID_PUBLIC_KEY_FINGERPRINT_MISMATCH",
        "There is a mismatch between the public key fingerprint specified in the issuer and the one stored for the user in Snowflake. For possible solutions, see Common Errors and Solutions.",
        "394305",
        "JWT_TOKEN_INVALID_ALGORITHM",
        "The JWT token was not signed with the RS256 algorithm.",
        "394306",
        "JWT_TOKEN_INVALID_SIGNATURE",
        "Snowflake could not verify the signature provided by the JWT token. It is possible that the JWT was signed with a private key that is not paired with the provided public key. It is also possible that the JWT signature is corrupt or has been modified.",
        "The most common errors associated with key pair authentication are:",
        "JWT_TOKEN_INVALID",
        "JWT_TOKEN_INVALID_PUBLIC_KEY_FINGERPRINT_MISMATCH",
        "JWT_TOKEN_INVALID_USER_IN_ISSUER",
        "JWT_TOKEN_INVALID_ISSUE_TIME",
        "Use the following descriptions and solutions to troubleshoot these errors.",
        "There is a general problem with the JWT token.",
        "The token itself might be malformed. Double-check that the application accessing Snowflake is generating valid JWT\ntokens.",
        "Double-check that the client (driver, connector, or request URL) is using the correct\naccount identifier to connect to the Snowflake account. You should also check that this value matches the\naccount identifier in the iss claim.",
        "Double-check that the account identifier and user name in the sub claim match the corresponding values in the\niss claim.",
        "Double-check that iss claim specifies SHA256 as the signing algorithm.",
        "There is a mismatch between the public key fingerprint specified in the issuer and the one stored for the user in\nSnowflake.",
        "Obtain the public key fingerprint of the JWT token, then compare it with the fingerprint associated with the user in\nSnowflake.",
        "One method of obtaining the fingerprint of the JWT token is to enable DEBUG logging for your driver and attempt to login. Look for the pattern SHA256:<hash>, where <hash> is the\npublic key fingerprint.",
        "To obtain the public key fingerprint associated with the user in Snowflake, execute the DESCRIBE USER command. The\npublic key fingerprint is located in either the RSA_PUBLIC_KEY_FP or the RSA_PUBLIC_KEY_2_FP property. If the user is missing a public key\nfingerprint, execute the ALTER USER command to set these properties.",
        "The user name specified in the issuer does not exist in the Snowflake account.",
        "The user name configured in the Snowflake client must match the LOGIN_NAME of the Snowflake user, not its\nNAME. Sometimes these values are different.",
        "Execute the DESCRIBE USER command and verify that the value of the LOGIN_NAME property matches the user name\nthat the Snowflake client is using to connect.",
        "The JWT token was received by Snowflake more than 60 seconds after the issue time.",
        "Check the host where the driver is running to ensure it is synchronized to NTP and doesn\u2019t have clock skew. If the server\nclock is skewed, Snowflake might determine that the current time is more than 60 seconds after the issue time of the token, when it really\nisn\u2019t.  For example, if the client machine is 30 seconds behind and it took the token 45 seconds to reach Snowflake, then Snowflake\ndetermines that it has been 75 seconds since the JWT token was issued, not 45 seconds.",
        "You can check that the clock of the client machine is accurate by comparing it to an NTP server. For example, you can use\nNIST Internet Time Servers to sync the client machine. For help with checking and\nsynchronizing your host\u2019s clock to an NTP server, refer to the administrator guide for your operating system or reach out to a system\nadministrator.",
        "Use an OS-specific monitoring tool to determine if the error occurs during times of extreme CPU/disk usage.",
        "Check whether there is excessive network latency that is causing the JWT token to be processed by Snowflake more than\n60 seconds after the token\u2019s issue time.",
        "When using a connectivity diagnostic tool to measure network latency, set the destination to\naccount_identifier.snowflakecomputing.com. For example, if the Snowflake client is using myorg-account1 as the account\nidentifier, set the destination to myorg-account1.snowflakecomputing.com.",
        "Was this page helpful?",
        "On this page",
        "Related content"
    ]
}