{
    "url": "https://docs.snowflake.com/en/sql-reference/sql/create-storage-integration",
    "title": "CREATE STORAGE INTEGRATION | Snowflake Documentation",
    "paragraphs": [
        "Creates a new storage integration in the account or replaces an existing integration.",
        "A storage integration is a Snowflake object that stores a generated identity and access management (IAM) entity for your external\ncloud storage, along with an optional set of allowed or blocked storage locations (Amazon S3, Google Cloud Storage, or Microsoft Azure).\nCloud provider administrators in your organization grant permissions on the storage locations to the generated entity. This option\nallows users to avoid supplying credentials when creating stages or when loading or unloading data.",
        "A single storage integration can support multiple external stages. The URL in the stage definition must align with the storage location\nspecified for the STORAGE_ALLOWED_LOCATIONS parameter.",
        "Note",
        "If your cloud storage is located on a different cloud platform from your Snowflake\naccount, the storage location must be in the public cloud and not a virtual private environment.",
        "Snowflake charges a per-byte fee when you unload data from Snowflake into an external stage in a different\nregion or different cloud provider. For details, see the\npricing page.",
        "Accessing cloud storage in a government region using a storage integration is limited to Snowflake\naccounts hosted in the same government region.",
        "Similarly, if you need to access cloud storage in a region in China, you can use a storage integration only from a Snowflake\naccount hosted in the same region in China.",
        "In these cases, use the CREDENTIALS parameter in the CREATE STAGE command (rather than using a storage\nintegration) to provide the credentials for authentication.",
        "ALTER STORAGE INTEGRATION , DROP INTEGRATION , SHOW INTEGRATIONS",
        "Where:",
        "String that specifies the identifier (i.e. name) for the integration; must be unique in your account.",
        "In addition, the identifier must start with an alphabetic character and cannot contain spaces or special characters unless the entire\nidentifier string is enclosed in double quotes (e.g. \"My object\"). Identifiers enclosed in double quotes are also case-sensitive.",
        "For more details, see Identifier requirements.",
        "Specify the type of integration:",
        "EXTERNAL_STAGE: Creates an interface between Snowflake and an external cloud storage location.",
        "Specifies whether this storage integration is available for usage in stages.",
        "TRUE allows users to create new stages that reference this integration. Existing stages that reference this integration\nfunction normally.",
        "FALSE prevents users from creating new stages that reference this integration. Existing stages that reference this integration\ncannot access the storage location in the stage definition.",
        "Explicitly limits external stages that use the integration to reference one or more storage locations (i.e. S3 bucket, GCS bucket, or\nAzure container). Supports a comma-separated list of URLs for existing buckets and, optionally, paths used to store data files for\nloading/unloading. Alternatively supports the * wildcard, meaning \u201callow access to all buckets and/or paths\u201d.",
        "Amazon S3",
        "STORAGE_ALLOWED_LOCATIONS = ( 'protocol://bucket/path/' [ , 'protocol://bucket/path/' ... ]\u00a0 )",
        "protocol is one of the following:",
        "s3 refers to S3 storage in public AWS regions outside of China.",
        "s3china refers to S3 storage in public AWS regions in China.",
        "s3gov refers to S3 storage in government regions.",
        "bucket is the name of an S3 bucket that stores your data files (e.g. mybucket).",
        "path is an optional case-sensitive path for files in the cloud storage location (i.e. files have names that begin with\na common string) that limits access to a set of files. Paths are alternatively called prefixes or folders by different cloud\nstorage services.",
        "Google Cloud Storage",
        "STORAGE_ALLOWED_LOCATIONS = ( 'gcs://bucket/path/' [ , 'gcs://bucket/path/' ... ] )",
        "bucket is the name of a GCS bucket that stores your data files (e.g. mybucket).",
        "path is an optional case-sensitive path for files in the cloud storage location (i.e. files have names that begin with\na common string) that limits access to a set of files. Paths are alternatively called prefixes or folders by different cloud\nstorage services.",
        "Microsoft Azure",
        "STORAGE_ALLOWED_LOCATIONS = ( 'azure://account.blob.core.windows.net/container/path/' [ , 'azure://account.blob.core.windows.net/container/path/' ... ] )",
        "account is the name of the Azure storage account (e.g. myaccount). Use the blob.core.windows.net endpoint\nfor all supported types of Azure blob storage accounts, including Data Lake Storage Gen2.",
        "container is the name of a Azure blob storage container that stores your data files (e.g. mycontainer).",
        "path is an optional case-sensitive path for files in the cloud storage location (i.e. files have names that begin with\na common string) that limits access to a set of files. Paths are alternatively called prefixes or folders by different cloud\nstorage services.",
        "Explicitly prohibits external stages that use the integration from referencing one or more storage locations (i.e. S3 buckets or\nGCS buckets). Supports a comma-separated list of URLs for existing storage locations and, optionally, paths used to store data files\nfor loading/unloading. Commonly used when STORAGE_ALLOWED_LOCATIONS is set to the * wildcard, allowing access to all buckets\nin your account except for blocked storage locations and, optionally, paths.",
        "Note",
        "Make sure to enclose only individual cloud storage location URLs in quotes. If you enclose the entire\nSTORAGE_BLOCKED_LOCATIONS value in quotes, the value is invalid. As a result, the STORAGE_BLOCKED_LOCATIONS\nparameter setting is ignored when users create stages that reference the storage integration.",
        "Amazon S3",
        "STORAGE_BLOCKED_LOCATIONS = ( 'protocol://bucket/path/' [ , 'protocol://bucket/path/' ... ]\u00a0 )",
        "protocol is one of the following:",
        "s3 refers to S3 storage in public AWS regions outside of China.",
        "s3china refers to S3 storage in public AWS regions in China.",
        "s3gov refers to S3 storage in government regions.",
        "bucket is the name of an S3 bucket that stores your data files (e.g. mybucket).",
        "path is an optional path (or directory) in the bucket that further limits access to the data files.",
        "Google Cloud Storage",
        "STORAGE_BLOCKED_LOCATIONS = ( 'gcs://bucket/path/' [ , 'gcs://bucket/path/' ... ] )",
        "bucket is the name of a GCS bucket that stores your data files (e.g. mybucket).",
        "path is an optional path (or directory) in the bucket that further limits access to the data files.",
        "Microsoft Azure",
        "STORAGE_BLOCKED_LOCATIONS = ( 'azure://account.blob.core.windows.net/container/path/' [ , 'azure://account.blob.core.windows.net/container/path/' ... ] )",
        "account is the name of the Azure storage account (e.g. myaccount).",
        "container is the name of a Azure blob storage container that stores your data files (e.g. mycontainer).",
        "path is an optional path (or directory) in the bucket that further limits access to the data files.",
        "String (literal) that specifies a comment for the integration.",
        "Default: No value",
        "Amazon S3",
        "Specifies the cloud storage provider that stores your data files:",
        "'S3': S3 storage in public AWS regions outside of China.",
        "'S3CHINA': S3 storage in public AWS regions in China.",
        "'S3GOV': S3 storage in AWS government regions.",
        "Specifies the Amazon Resource Name (ARN) of the AWS identity and access management (IAM) role that grants privileges on the S3 bucket\ncontaining your data files. For more information, see Configuring secure access to Amazon S3.",
        "Optionally specifies an external ID that Snowflake uses to establish a trust relationship with AWS.\nYou must specify the same external ID in the trust policy of the IAM role\nthat you configured for this storage integration. For more information,\nsee How to use an external ID when granting access to your AWS resources to a third party.",
        "If you don\u2019t specify a value for this parameter,\nSnowflake automatically generates an external ID when you create the storage integration.",
        "Enables support for AWS access control lists (ACLs) to grant the bucket owner full control. Files created in Amazon S3 buckets from\nunloaded table data are owned by an AWS Identity and Access Management (IAM) role. ACLs support the use case where IAM roles in one\nAWS account are configured to access S3 buckets in one or more other AWS accounts. Without ACL support, users in the bucket-owner\naccounts could not access the data files unloaded to an external (S3) stage using a storage integration.",
        "When users unload Snowflake table data to data files in an S3 stage using COPY INTO <location>, the unload\noperation applies an ACL to the unloaded data files. The data files apply the \"s3:x-amz-acl\":\"bucket-owner-full-control\"\nprivilege to the files, granting the S3 bucket owner full control over them.",
        "Google Cloud Storage",
        "Specifies the cloud storage provider that stores your data files.",
        "Microsoft Azure",
        "Specifies the cloud storage provider that stores your data files.",
        "Specifies the ID for your Office 365 tenant that the allowed and blocked storage accounts belong to. A storage integration can\nauthenticate to only one tenant, and so the allowed and blocked storage locations must refer to storage accounts that all belong\nthis tenant.",
        "To find your tenant ID, log into the Azure portal and click Azure Active Directory \u00bb Properties. The tenant ID\nis displayed in the Tenant ID field.",
        "Specifies whether to use outbound private connectivity. For information about using this parameter, see Azure private connectivity for external stages and Snowpipe automation.",
        "A role used to execute this SQL command must have the following\nprivileges at a minimum:",
        "Privilege",
        "Object",
        "Notes",
        "CREATE INTEGRATION",
        "Account",
        "Only the ACCOUNTADMIN role has this privilege by default. The privilege can be granted to additional roles as needed.",
        "For instructions on creating a custom role with a specified set of privileges, see Creating custom roles.",
        "For general information about roles and privilege grants for performing SQL actions on\nsecurable objects, see Overview of Access Control.",
        "Caution",
        "Recreating a storage integration (using CREATE OR REPLACE STORAGE INTEGRATION) breaks the association between the storage integration\nand any stage that references it. This is because a stage links to a storage integration using a hidden ID rather than the name of the\nstorage integration. Behind the scenes, the CREATE OR REPLACE syntax drops the object and recreates it with a different hidden ID.",
        "If you must recreate a storage integration after it has been linked to one or more stages, you must reestablish the association between\neach stage and the storage integration by executing ALTER STAGE stage_name SET STORAGE_INTEGRATION =\nstorage_integration_name, where:",
        "stage_name is the name of the stage.",
        "storage_integration_name is the name of the storage integration.",
        "Regarding metadata:",
        "Attention",
        "Customers should ensure that no personal data (other than for a User object), sensitive data, export-controlled data, or other regulated data is entered as metadata when using the Snowflake service. For more information, see Metadata fields in Snowflake.",
        "CREATE OR REPLACE <object> statements are atomic. That is, when an object is replaced, the old object is deleted and the new object is created in a single transaction.",
        "The following example creates an integration that explicitly limits external stages that use the integration to reference either of\ntwo buckets and paths:",
        "Amazon S3",
        "If the S3 storage is in a public AWS region in China, use 'S3CHINA' for the STORAGE_PROVIDER parameter and\ns3china:// protocol in STORAGE_ALLOWED_LOCATIONS.",
        "Google Cloud Storage",
        "Microsoft Azure",
        "The following example creates an integration that allows external stages that use the integration to reference any bucket and\npath in your account except for those that are explicitly blocked:",
        "Amazon S3",
        "If the S3 storage is in a public AWS region in China, use 'S3CHINA' for the STORAGE_PROVIDER parameter and\ns3china:// protocol in STORAGE_BLOCKED_LOCATIONS.",
        "Google Cloud Storage",
        "Microsoft Azure",
        "Was this page helpful?",
        "On this page",
        "Related content"
    ]
}