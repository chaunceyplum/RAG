{
    "url": "https://docs.snowflake.com/en/user-guide/tables-iceberg-best-practices",
    "title": "Best practices | Snowflake Documentation",
    "paragraphs": [
        "This topic provides best practices for working with Apache Iceberg\u2122 tables in Snowflake.",
        "Each external volume is associated with a particular Active storage location,\nand a single external volume can support multiple Iceberg tables. However, the number of external volumes you need depends on how you want to store,\norganize, and secure your table data.",
        "You can use a single external volume if you want the data and metadata\nfor all of your Snowflake-Iceberg tables in subdirectories under the same storage location (for example, in the same S3 bucket).\nTo configure these directories for Snowflake-managed tables, see Data and metadata directories.",
        "Alternatively, you can create multiple external volumes to secure various storage locations differently. For example,\nyou might create the following external volumes:",
        "A read-only external volume for externally managed Iceberg tables.",
        "An external volume configured with read and write access for Snowflake-managed tables.",
        "For data loading with COPY INTO <table>\nand Snowpipe,\nuse the following format options for your Parquet data files:",
        "BINARY_AS_TEXT = FALSE",
        "USE_LOGICAL_TYPE = TRUE",
        "USE_VECTORIZED_SCANNER = TRUE",
        "REPLACE_INVALID_CHARACTERS = TRUE",
        "To prevent long refresh times and get the most up-to-date table data quickly,\nperform frequent refreshes on Iceberg tables that use an external catalog.",
        "Snowflake attempts to optimize table refreshes when it expects the operation to take a long time.\nHowever, refresh time ultimately depends on the number of snapshots associated with a table, and the number of data\nfiles that belong to a table.",
        "It\u2019s also important to align your Snowflake refresh schedule with table maintenance operations such as snapshot expiration or compaction.\nRefresh the metadata each time you perform a maintenance operation.",
        "For instructions, see Refresh the table metadata.",
        "To optimize query runtime performance for tables that aren\u2019t managed by Snowflake,\nmake sure your Parquet file statistics are as complete as possible.",
        "Ensure that the Parquet file writer you use (for example, Spark or Trino) is configured to write statistics.\nYou might also need to update your writer to the latest version.",
        "Missing statistics like the following degrade query performance:",
        "Minimum and maximum values.",
        "Number of distinct values (NDV). The number of distinct values is used to determine the join order in complex joins. Missing NDV statistics\ncan lead to join explosion.",
        "Number of NULL counts.",
        "When you create an Iceberg table that uses an external catalog, Snowflake attempts to read statistics from the table manifest files\nto provide faster performance.",
        "In some situations, such as when there are missing or incorrect statistics in the manifest files, Snowflake\nscans the table data files for statistics. Scanning a large number of data files can slow down table creation.\nTo accelerate the table creation process, use a larger warehouse that can scan table files in parallel.",
        "Note",
        "Snowflake doesn\u2019t parallelize table column scanning. Switching to a larger warehouse doesn\u2019t result in faster query runtime.",
        "Choose an appropriate STORAGE_SERIALIZATION_POLICY for your use case.\nWhen you create a Snowflake-managed table (or convert a table to use Snowflake as the catalog), you set a storage serialization policy for\nthat table. The serialization policy tells Snowflake what kind of encoding and compression to perform on the table data files.",
        "An unsuitable policy might make a table incompatible with external engines or cause performance degradation in Snowflake.",
        "For more information, see CREATE ICEBERG TABLE (Snowflake as the Iceberg catalog).",
        "Was this page helpful?",
        "On this page",
        "Related content"
    ]
}