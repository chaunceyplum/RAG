{
    "url": "https://docs.snowflake.com/en/developer-guide/stored-procedures-vs-udfs",
    "title": "Choosing whether to write a stored procedure or a user-defined function | Snowflake Documentation",
    "paragraphs": [
        "This topic describes key differences between stored procedures and UDFs, including differences in how each may be invoked and in what\nthey may do.",
        "At a high level, stored procedures and UDFs differ in how they are typically used, as described below.",
        "Stored Procedure Purpose",
        "User-Defined Function Purpose",
        "Generally to perform administrative operations by executing SQL statements. The body of a stored procedure is allowed, but not\nrequired, to explicitly return a value (such as an error indicator).",
        "Calculate and return a value. A function always returns a value explicitly by specifying an expression. For example, the body of a\nJavaScript UDF must have a return statement that returns a value.",
        "In general, when deciding whether to create a stored procedure or UDF, consider the following recommendations:",
        "Create a Stored Procedure When\u2026",
        "Create a UDF When\u2026",
        "You\u2019re migrating an existing stored procedure from another application/system.",
        "You need to perform DDL or DML database operations:",
        "Administrative tasks, including DDL such as deleting temporary tables, deleting data older than N days, or adding users.",
        "DML statements (UPDATE statements, for example)",
        "You\u2019re migrating an existing UDF from another application/system.",
        "You need a function that can be called as part of a SQL statement and that must return a value that will be used in the statement.",
        "Your output needs to include a value for every input row or every group. For example:",
        "You need to perform simple queries with SQL, such as SELECT statements.",
        "When you write a procedure or UDF, you write its logic as a handler in one of the supported languages. The following table lists the\nsupported languages.",
        "Stored Procedures",
        "User-Defined Functions",
        "Java",
        "Java",
        "JavaScript",
        "JavaScript",
        "Python",
        "Python",
        "Scala",
        "Scala",
        "Snowflake Scripting",
        "SQL",
        "The following sections describe specific differences in the behaviors supported by procedures and UDFs.",
        "A UDF always returns a value explicitly by specifying an expression. A UDF\u2019s purpose is to calculate and return a value.\nFor example, the body of a JavaScript UDF must have a return statement that returns a value.",
        "A stored procedure is allowed, but not required, to explicitly return a value (such as an error indicator). The purpose of a stored\nprocedure generally is to perform administrative operations by executing SQL statements. If a procedure does not explicitly return a\nvalue, then it implicitly returns NULL.",
        "Note that every CREATE PROCEDURE statement must include a RETURNS clause that specifies a return type, even if the procedure\ndoes not explicitly return anything. If a procedure does not explicitly return a value, then it implicitly returns NULL.",
        "Code in the following example declares a return type for the procedure with a RETURNS clause, but a value is only returned in the\ncase of an error. In other words, not every code path returns a value.",
        "If you are not calling the stored procedure from a Snowflake Scripting block, you cannot use the value returned by a stored\nprocedure directly in SQL (unlike the value returned by a function). The syntax of the CALL command does not provide a place to\nstore the returned value or a way to operate on it or pass the value to another operation. In other words, the following statement\nis not a valid SQL statement:",
        "If you call a stored procedure within a Snowflake Scripting block,\nyou can capture the value returned by the stored procedure\nin a Snowflake Scripting variable.",
        "You can also indirectly use the return value of a stored procedure (outside of a Snowflake Scripting block), as described in the following\nlist:",
        "You can call the stored procedure inside another stored procedure. For example, when the stored procedure handler is written in JavaScript,\nthe JavaScript in the outer stored procedure can retrieve and store the output of the inner stored procedure. Remember, however, that\nthe outer stored procedure (and each inner stored procedure) is still unable to return more than one value to its caller.",
        "You can call a stored procedure that returns tabular data in the\nFROM clause of a SELECT statement.",
        "You can call the stored procedure and then call the RESULT_SCAN function and pass it\nthe statement ID generated for the stored procedure.",
        "You can store a result set in a temporary table or permanent table, and use that table after returning from the\nstored procedure call.",
        "If the volume of data is not too large, you can store multiple rows and multiple columns in a VARIANT (for\nexample, as a JSON value) and return that VARIANT.",
        "A UDF evaluates to a value and can be used in contexts in which a general expression can be used, such as the following:",
        "A stored procedure does not evaluate to a value, and cannot be used in all contexts in which a general expression can be used.\nFor example, you cannot execute SELECT my_stored_procedure()....",
        "You call a stored procedure as an independent statement, as in the following example:",
        "For more details about calling functions and procedures, see the following:",
        "Calling a stored procedure",
        "Calling a UDF",
        "A single SQL statement can call multiple UDFs.",
        "A single SQL statement can call only one stored procedure.",
        "Similarly, a stored procedure, unlike a UDF, cannot be called as part of an expression. However, inside a stored procedure, the stored\nprocedure can call another stored procedure, or call itself recursively. For example, see the code examples section\nExamples.",
        "For more details about calling functions and procedures, see the following:",
        "Calling a stored procedure",
        "Calling a UDF",
        "In a UDF, you can use SQL to execute queries only (not DML or DDL statements).",
        "Within a stored procedure, you can execute database operations, such as SELECT, UPDATE, and CREATE:",
        "For example, in a JavaScript stored procedure, you can use the JavaScript API to perform these operations.",
        "The example below shows how a stored procedure can create and execute a SQL statement that calls another stored\nprocedure. The $$ indicates the beginning and end of the JavaScript handler code in the stored procedure.",
        "In a Snowflake Scripting stored procedure, you can execute SQL statements.",
        "The example below shows how a stored procedure can create and execute a SQL statement that calls another stored\nprocedure. The $$ indicates the beginning and end of the Snowflake Scripting code in the stored procedure.",
        "Was this page helpful?",
        "On this page",
        "Related content"
    ]
}