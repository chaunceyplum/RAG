{
    "url": "https://docs.snowflake.com/en/user-guide/admin-security-fed-auth-security-integration",
    "title": "Configuring Snowflake to use federated authentication | Snowflake Documentation",
    "paragraphs": [
        "This topic describes how to configure Snowflake for federated authentication using a SAML2 security integration. This topic assumes you have\nalready configured your IdP to work with Snowflake.",
        "Note",
        "A SAML2 security integration replaces the deprecated SAML_IDENTITY_PROVIDER account parameter.",
        "If you have an existing SSO implementation that uses this deprecated account parameter, you should migrate to a SAML security\nintegration before continuing to configure Snowflake for federated\nauthentication.",
        "Snowflake will continue to support the deprecated account parameter as long as there are implementations that use it.",
        "Snowflake uses a SAML2 security integration to integrate with the IdP you are using to implement federated authentication. Use the\nCREATE SECURITY INTEGRATION command to start configuring Snowflake for SSO.",
        "Important",
        "When you configure an IdP for SSO, provide a URL for the Snowflake\naccount. The format of this URL must match the URLs in the SAML2_SNOWFLAKE_ISSUER_URL and\nSAML2_SNOWFLAKE_ACS_URL properties of the security integration.",
        "If you do not define these properties when creating the security integration, then they default to the\nlegacy URL of the account.",
        "For example, to create a security integration that uses an account name URL with private connectivity, run the following SQL command:",
        "Note that /fed/login is appended to the URL for the SAML2_SNOWFLAKE_ACS_URL property. For more details about URL formats for\nSnowflake accounts, see Connecting with a URL.",
        "After configuring a SAML2 security integration, you can use the security integration to do the following tasks:",
        "Encrypt SAML Assertions",
        "Send Signed SAML Requests",
        "Specify the SAML NameID Format",
        "Export the SAML2 Security Integration Metadata",
        "Force Re-authentication to Snowflake Procedure",
        "Note",
        "You can use a SAML2 security integration with Client Redirect if your\naccount is a Business Critical Edition or higher.",
        "For more information, see Redirecting client connections.",
        "After you have created a SAML2 security integration, you can configure whether the user starts their SSO login from the IdP or from\nSnowflake.",
        "An IdP-initiated SSO does not require configuration in Snowflake. You only need to inform your users about how to access Snowflake (e.g.\nusing an internal portal).",
        "The SAML2_ENABLE_SP_INITIATED property enables Snowflake-initiated SSO. The SAML2_SP_INITIATED_LOGIN_PAGE_LABEL property\ndefines a string that identifies the IdP. This string appears on the Snowflake login page so users can access the IdP.",
        "Use the ALTER SECURITY INTEGRATION command to set these properties:",
        "For information about how clients connect to Snowflake after you have configured SSO login for users, see\nUsing SSO with client applications that connect to Snowflake",
        "The SAML2_SNOWFLAKE_X509_CERT property ensures that SAML2 assertions are encrypted using Snowflake\u2019s public certificate, securing\ntraffic when users access Snowflake through federated authentication.",
        "After receiving the encrypted assertions from the customer IdP, Snowflake decrypts the encrypted assertions with its private key. Snowflake\nnever exports or makes its private key available.",
        "To encrypt SAML assertions, see the sections below.",
        "After you have created a SAML2 security integration, follow the steps below:",
        "Execute the following SQL statement on the SAML2 integration.",
        "Find the SAML2_SNOWFLAKE_X509_CERT value in row 7, which is the public certificate in PEM format.",
        "Save the value, ensuring you include the BEGIN CERTIFICATE and END CERTIFICATE delimiters. For example, the codeblock\nbelow contains a truncated certificate in PEM format:",
        "By default, a SAML2 security integration in Snowflake uses a self-signed certificate for the SAML IdP to encrypt SAML assertions. If your\norganization requires using a certificate issued from a Certificate Authority (CA), then complete the steps below:",
        "Generate a certificate signing request (CSR) from Snowflake using the system function\nSYSTEM$GENERATE_SAML_CSR.",
        "Provide the CSR to the CA of your choice so that the certificate can be issued.",
        "Upload the Base64-encoded certificate into the SAML integration using the following ALTER statement, without the\nBEGIN CERTIFICATE and END CERTIFICATE delimiters.",
        "Execute the DESCRIBE INTEGRATION command to view the updated security integration:",
        "You can then upload the certificate for your private key using the CSR generated by the function into Snowflake.",
        "Upload the saved certificate in PEM format to your organization\u2019s IdP as the SAML Encryption certificate.",
        "Configure your IdP to encrypt SAML Assertions for the Snowflake service provider (SP).",
        "You can send a signed SAML request from Snowflake to the IdP to verify Snowflake as an authentic service provider. To verify Snowflake, you\ncan configure your IdP to use the certificate stored in the SAML2 security integration to ensure the SAML request originates from Snowflake,\nnot a third-party that is impersonating Snowflake.",
        "If you are creating a SAML2 security integration for the first time, ensure you set the\nSAML2_SIGN_REQUEST property.",
        "If you created a SAML2 security integration without setting the SAML2_SIGN_REQUEST property, follow the steps below:",
        "Execute the ALTER SECURITY INTEGRATION command as a user with an\nACCOUNTADMIN role to update the security integration:",
        "Execute the DESCRIBE INTEGRATION command to view the updated security integration:",
        "Configure your IdP to accept signed requests from Snowflake. During the configuration, your IdP needs to have the certificate stored in the\nSAML2_SNOWFLAKE_X509_CERT property. Your IdP uses this certificate to verify\nthat the SAML request originates from Snowflake.",
        "Note",
        "Snowflake is not responsible for configuring your IdP. For help with configuring your IdP, please consult your internal security\nadministrator.",
        "Execute the DESCRIBE INTEGRATION command:",
        "Save the value of the SAML2_SNOWFLAKE_X509_CERT property in row 7 to use in\nyour IdP settings.",
        "Snowflake supports allowing the administrator (i.e. user with the ACCOUNTADMIN role) to specify the SAML NameID format that will be\nrequested in the outgoing SAML authentication request sent from Snowflake to the IdP.",
        "Specifying the SAML NameID format allows Snowflake to set an expectation of the identifying attribute of the user (i.e. SAML\nSubject) in the SAML assertion from the IdP to ensure a valid authentication to Snowflake.",
        "The SAML NameID format can be integrated into the SAML2 security integration. You can specify the SAML NameID in the\nsecurity integration using one of the following values:",
        "urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified",
        "urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress",
        "urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName",
        "urn:oasis:names:tc:SAML:1.1:nameid-format:WindowsDomainQualifiedName",
        "urn:oasis:names:tc:SAML:2.0:nameid-format:kerberos",
        "urn:oasis:names:tc:SAML:2.0:nameid-format:persistent",
        "urn:oasis:names:tc:SAML:2.0:nameid-format:transient",
        "If the SAML NameID format is not specified, Snowflake uses the following value:",
        "urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress",
        "If you are creating a SAML2 security integration for the first time, ensure you set the\nSAML2_REQUESTED_NAMEID_FORMAT property.",
        "If you created a SAML2 security integration without setting the SAML2_REQUESTED_NAMEID_FORMAT property, follow the steps below:",
        "Execute the ALTER SECURITY INTEGRATION command as a user with an\nACCOUNTADMIN role to specify the SAML NameId format:",
        "Execute the DESCRIBE INTEGRATION command to view the updated security integration:",
        "Configure your IdP to specify the SAML NameID format in SAML assertions.",
        "Note",
        "Snowflake is not responsible for configuring your IdP. For help with configuring your IdP, please consult your internal security\nadministrator.",
        "Snowflake provides SAML 2.0 metadata for the SAML2 security integration to facilitate configuring the Snowflake service provider in your\nIdP.",
        "The SAML 2.0 metadata is contained in the SAML2_SNOWFLAKE_METADATA property and can be obtained by executing a\nDESCRIBE INTEGRATION command on the SAML2 security integration. For example:",
        "As a representative example, the formatted SAML 2.0 XML metadata from the SAML2_SNOWFLAKE_METADATA property is shown below. Note\nthat the X509certificate values for signing and encryption are truncated.",
        "For reference, the following table maps the XML metadata tags to the Snowflake SAML2 security integration properties.",
        "XML Output",
        "SAML2 Security Integration Property",
        "entityID",
        "SAML2_SNOWFLAKE_ISSUER_URL",
        "AuthnRequestsSigned",
        "SAML2_SIGN_REQUEST",
        "Signing Certificate",
        "SAML2_SNOWFLAKE_X509_CERT",
        "Encryption Certificate",
        "SAML2_SNOWFLAKE_X509_CERT",
        "Assertion Consumer Service URL",
        "SAML2_SNOWFLAKE_ACS_URL",
        "Snowflake supports configuring your SAML2 security integration to require the authenticating user to re-authenticate to access Snowflake\nduring the initial authentication SSO flow or when a current Snowflake session expires.",
        "When enabling this feature in the Snowflake SAML2 security integration, Snowflake sets the SAML specification ForceAuthn property\nto True in the outgoing SAML request from Snowflake to the IdP. Once the IdP receives the request with ForceAuthn property\nset to True, the IdP sends a request to Snowflake which results in users being prompted to re-enter their authentication credentials\n(e.g. username, password) to access Snowflake.",
        "This feature provides enhanced security through re-authentication. In addition, the re-authentication prompt allows users to input a\ndifferent set of credentials than those used to initiate SSO to access Snowflake.",
        "Important",
        "Before implementing this feature, verify that your IdP supports switching identities during an SSO authentication flow.",
        "If this feature is implemented in Snowflake and your IdP does not support switching identities during the initial SSO authentication flow,\nusers might not be able to access Snowflake using the different set of credentials provided in the re-authentication prompt.",
        "If you are creating a SAML2 security integration for the first time, ensure you set the\nSAML2_FORCE_AUTHN property.",
        "To update an existing SAML2 security integration to support forced re-authentication to access Snowflake, follow the steps below:",
        "Execute the ALTER SECURITY INTEGRATION command to update the security\nintegration:",
        "Execute the DESCRIBE INTEGRATION command to view the updated security integration:",
        "Where:",
        "The Boolean indicating whether users, during the initial authentication flow, are forced to authenticate again to access Snowflake. When\nset to TRUE, Snowflake sets the ForceAuthn SAML property to TRUE in the outgoing request from Snowflake to the\nidentity provider.",
        "TRUE forces users to authenticate again to access Snowflake, even if a valid session with the identity provider exists.",
        "FALSE does not force users to authenticate again to access Snowflake.",
        "Default: FALSE.",
        "Snowflake supports defining a custom endpoint URL to redirect users to after logging out of Snowflake. The endpoint is set through the\nSAML2_POST_LOGOUT_REDIRECT_URL property in the SAML2 security integration.",
        "Once enabled for users who access Snowflake through SAML SSO, clicking the Log Out button in the Classic Console results in\nSnowflake terminating the Snowflake session and redirecting users to the specified endpoint.",
        "Important",
        "This behavior does not apply to Snowsight.",
        "Defining a logout endpoint provides administrators the option to control where users are redirected after logging out of Snowflake. For\nexample, a custom endpoint could trigger a script to simultaneously terminate the IdP session. The advantage of this implementation is that\nboth the Snowflake and IdP sessions are terminated, which forces users to re-authenticate against the IdP to access Snowflake.",
        "If you are creating a SAML2 security integration for the first time, ensure you set the\nSAML2_POST_LOGOUT_REDIRECT_URL property.",
        "If you created a SAML2 security integration without setting the SAML2_POST_LOGOUT_REDIRECT_URL property, execute the\nALTER SECURITY INTEGRATION command to configure the custom logout endpoint:",
        "You can use an ALTER SECURITY INTEGRATION command to manage the SAML2 security\nintegration. For example:",
        "Update the X.509 certificate as a string into an existing SAML2 security integration.",
        "If you are a customer who configures your IdP to verify SAML request signatures or encrypt SAML responses, then you can overwrite your\nexisting private key and self-signed certificate, and generate a new private key and self-signed certificate:",
        "Generate a new private key:",
        "Caution",
        "After running the command below, SAML authentication stops working because your IdP still uses your old\nSAML2_SNOWFLAKE_X509_CERT certificate. To minimize disruptions, you should run the command below when users are not as\nactive.",
        "Retrieve the value of the SAML2_SNOWFLAKE_X509_CERT property in your security integration:",
        "Upload the retrieved value to your IdP to replace your old certificate with your new certificate in your IdP.",
        "Enable signed requests.",
        "Specify the NameID format.",
        "Update an existing security integration to enable forced re-authentication.",
        "Update an existing security integration to disable forced re-authentication.",
        "Update the custom logout endpoint.",
        "For more information, see ALTER SECURITY INTEGRATION.",
        "Snowflake supports replication and failover/failback of the\nSAML2 security integration from a source account to a target account.",
        "For details, see Replication of security integrations & network policies across multiple accounts.",
        "Was this page helpful?",
        "On this page",
        "Related content"
    ]
}