{
    "url": "https://docs.snowflake.com/en/sql-reference/external-functions-creating-azure-planning",
    "title": "Planning an external function for Azure | Snowflake Documentation",
    "paragraphs": [
        "This topic helps you prepare to create an external function for Microsoft Azure using either the Azure Portal or an ARM (Azure Resource\nManager) template provided by Snowflake.",
        "These instructions assume that you are an experienced Azure Portal user.",
        "To create an external function for Azure, you must have the following:",
        "An Azure AD (Active Directory) tenant.",
        "An account in that Azure AD tenant. The account must have privileges to:",
        "Create an Azure Functions app.",
        "Create a service endpoint using Azure API Management service.",
        "Register an Azure AD Application.",
        "A Snowflake account in which you have the ACCOUNTADMIN role or a role with the CREATE INTEGRATION privilege.",
        "In addition, you should already have an Azure AD Tenant ID.",
        "The Azure AD Tenant ID is a UUID , which typically is formatted to look\nsimilar to 12345678-abcd-1234-efab-123456789012, where each non-dash character is a hexadecimal digit.",
        "If you do not already know your Azure AD tenant ID, you can find it using the following procedure:",
        "Log into the Azure Portal (http://portal.azure.com).",
        "In the Azure services icons near the top of the page, click on Azure Active Directory.",
        "In the menu on the left-hand side, look for the section titled Manage, then click on Properties under that.",
        "The Azure AD tenant ID is displayed in the Tenant ID field.",
        "When you call an external function, the connectivity from Snowflake to the external service can go through the public Internet or use\nAzure Private Link (Microsoft documentation). The choice to\nuse Azure Private Link depends on your security requirements in terms of how you need to connect to the external service. Using Azure\nPrivate Link can help you meet your security requirements.",
        "If you choose to use the public Internet, finish the remainder of this topic and follow the numbered topics for creating an external\nfunction on Azure using the Azure Portal or the ARM template.",
        "If you choose to use Azure Private Link, the configuration process requires using the ACCOUNTADMIN role and a Snowflake account that is\nBusiness Critical Edition (or higher). There is an additional billing charge to use Azure Private Link. Finish the remainder of this topic and review these topics for more information:",
        "Private connectivity for outbound network traffic",
        "Manage private connectivity endpoints: Azure",
        "Private connectivity with external functions: Azure ARM template (includes billing section)",
        "Private connectivity with external functions: Azure Portal (includes billing section)",
        "Snowflake provides instructions for two ways to create an external function on Azure:",
        "Azure Portal web interface",
        "ARM (Azure Resource Manager) template provided by Snowflake",
        "You can use the Azure Portal to create an Azure Function (as the remote\nservice) and an API Management service instance (as the proxy service). If you choose this method, you also use the Azure Portal to\nconfigure security-related settings.",
        "The instructions for creating an external function using the Azure Portal include a sample Azure Function and details for creating a basic\nAPI Management service instance:",
        "First-time users can use the instructions and sample Azure Function with little or no modification.",
        "Experienced users can use the instructions and sample Azure Function as a starting point for creating a custom Azure Function and a\ncustom-configured API Management service instance.",
        "An ARM template uses JSON to describe\nconfiguration information about an Azure Function (as the remote service) and an Azure API Management service instance (as the proxy\nservice).",
        "Snowflake provides a sample ARM template that includes the following:",
        "Sample Azure Function.",
        "Most of the configuration information for a sample API Management service. You must enter some additional information if you wish to\ncustomize the sample API Management service.",
        "Code to create a storage account needed by the Azure Functions service.",
        "Code to add a validate-JWT (JSON Web Token) Policy to the API Management instance in order to increase security of the Azure API\nManagement service. However, you must manually update the validate-JWT policy before using it.",
        "ARM templates can be useful for both first-time and experienced users:",
        "First-time users might want to start with the Snowflake sample template because it reduces the number of steps required to create the\nAzure Function and the API Management service instance.",
        "Note that although the template-based instructions help you create your first external function quickly, they skip steps that\nmost users need when creating customized external functions.",
        "Experienced users might want to use ARM templates because templates can be used to automate deployment. This can be useful if you are\ndeveloping an Azure Function and API Management service iteratively.",
        "For more information about configuring Azure Functions using ARM templates, see the Microsoft documentation:\nresource deployment .",
        "These sections help you prepare to use the Azure Portal to create an external function on Microsoft Azure.",
        "In Microsoft Azure, an Azure Function (remote service) can run on a Linux host or Windows host. At this time, Azure offers different\ncombinations of pricing and authentication options for Linux and Windows hosts.",
        "If you plan to run your Azure Function on Linux, then you must choose a valid combination of Azure pricing plan and authentication:",
        "If you use the Premium or App Service pricing plan:",
        "Create the Azure AD (Active Directory) application from the Authentication/Authorization tab on the Azure Functions\nscreen in the Azure Portal.",
        "Use Azure AD for authentication with the Azure Functions service.",
        "Additional details and links are provided later in the\ninstructions for creating a remote service.",
        "If you use the Consumption pricing plan:",
        "Manually create the Azure AD application in the Azure Portal. Additional details are provided later in the\ninstructions for creating a remote service.",
        "Set a validate-JWT policy for the API Management instance. For details, see Step 6: Create the Azure security policy for the proxy service in the Portal.",
        "Use IP address restrictions to limit the remote service to accept connections only from the API Management service instance. For\ndetails, see Restrict the IP addresses that accept Azure functions calls (optional).",
        "As you complete the tasks to create an external function in the Azure Portal, you are required to enter specific values\n(e.g. API Management service name) during each step in the process. Often, the values you enter are required in subsequent steps.",
        "To facilitate recording/tracking this information, we\u2019ve provided a worksheet with fields for each of the required values:",
        "These sections help you prepare to use the ARM template provided by Snowflake to create an external function on Microsoft Azure.",
        "The template is available to download from the\nSnowflake repository in GitHub.",
        "Before you can use the template, you must import it into the Azure Portal. Details for importing the template are included later in the\ntopic that describes using the template.",
        "In Microsoft Azure, an Azure Function (remote service) can run on a Linux host or Windows host. At this time, Azure offers different\ncombinations of pricing and authentication options for Linux and Windows hosts.",
        "The Snowflake-provided ARM template defaults to using the following pricing plan and authentication information:",
        "Defaults to using a Windows host for the Azure Function.",
        "Defaults to the \u201cConsumption\u201d pricing tier.",
        "Creates an Azure Functions app, and configures that app to require AD (Active Directory) authentication.",
        "Creates a security policy to validate a JWT (JSON Web Token) that authorizes Snowflake to call your\nAzure Function.",
        "Note that this security policy is missing one field; instructions provided later tell you how to fill in this field.",
        "If you plan to run your Azure API management instance or Azure Function with a different configuration, you must update the\ntemplate. For information about updating the template, see the Microsoft documentation:",
        "Automating resource deployment\n(for your function app in Azure Functions)",
        "As you complete the tasks to create an external function using the ARM template provided by Snowflake, you are required to enter specific\nvalues (e.g. API Management service name) during each step in the process. Often, the values you enter are required in subsequent steps.",
        "To facilitate recording/tracking this information, we\u2019ve provided a worksheet with fields for each of the required values:",
        "Note",
        "For information hard-coded in the ARM template, the values have already been filled in.",
        "Step 1: Create the remote service (Azure function) in the Portal",
        "Step 1: Create an Azure AD app for the Azure functions app in the Portal",
        "Was this page helpful?",
        "On this page"
    ]
}