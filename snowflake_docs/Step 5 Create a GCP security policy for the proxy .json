{
    "url": "https://docs.snowflake.com/en/sql-reference/external-functions-creating-gcp-ui-security-policy",
    "title": "Step 5: Create a GCP security policy for the proxy service in the console | Snowflake Documentation",
    "paragraphs": [
        "In the previous steps, you created a Google Cloud Function that can be called by anyone who has the correct Google Cloud API Gateway\nendpoint. Unless you want the endpoint to be open to the public, you should secure it by creating a security policy on the Google Cloud\nAPI Gateway.",
        "This topic provides instructions for creating a security policy for the API Gateway by adding a customized securityDefinitions\nsection to the configuration file for the API definition.",
        "Important",
        "Snowflake strongly recommends creating a security policy for the API Gateway. After completing this step, only Snowflake is allowed to\ncall your Cloud Function through the API Gateway.",
        "Step 4: Create the external function for GCP in Snowflake",
        "For more detailed information about using the Google Cloud Console to perform the tasks described in this topic, see the following topics\nin the Google Cloud API Gateway documentation:",
        "Securing Access by Using an API Key",
        "Testing Your API Key",
        "Note",
        "The name of the configuration file is recorded in the Configuration File Name field in your tracking worksheet.",
        "Add or update the following securityDefinitions section in the configuration file. Add this immediately above the\nschemes section of the configuration file and at the same indentation level.",
        "In the section:",
        "Replace <security-def-name> with a unique security definition name (e.g. snowflakeAccess01). If you added the temporary security definition in step 2 of the tutorial (Step 2: Create the proxy service (Google Cloud API Gateway) in the console), this is already done.",
        "In addition, record this name in the Security Definition Name field in your tracking worksheet.",
        "Replace <gmail service account> with the value from the API_GCP_SERVICE_ACCOUNT field in your tracking worksheet.\nAdd the value in two places in the configuration file:",
        "x-google-issuer field",
        "x-google-jwks_uri field (appended to the end of the field)",
        "Update the post: section of the configuration file to reference the security definition that you created\nabove.",
        "Below the operationId field, add:",
        "This should be indented at the same level as the operationId field.",
        "Replace <security-def-name> with the value from the Security Definition Name field in your tracking worksheet if you have not already done so.",
        "Make sure to include a hyphen and a blank prior to the security definition name, as shown above.",
        "Make sure to include the empty square braces ([]) after the colon.",
        "For example:",
        "Save the configuration file.",
        "Your updated configuration file should look similar to the following:",
        "After updating the configuration file, you must reload the file in the Google Cloud Console:",
        "On the Gateways page, click on the name of your gateway.",
        "Click on EDIT.",
        "Under API Config, click in the box titled Select a Config.",
        "Select the option Create new API config.",
        "In the box that contains Upload an API Spec, click on the BROWSE button.",
        "Select the desired YAML file, which you created previously. Check that it has the extension .yaml or .yml.",
        "Enter the Display Name. Use a new, unique name, not the name that you used previously.",
        "If you are asked to Select a Service Account, then select App Engine default service account.",
        "If you are creating a function to use in production (rather than as a sample), you might choose a different service account.",
        "The selected service account must have appropriate privileges, including privileges to call the Google Cloud Function.",
        "You should now be back on the page for your API gateway. If the Config field shows the old API config file\u2019s display name:",
        "Click on EDIT.",
        "Under API Config, find the Select a Config box again, and click in the box.",
        "Select the new API config.",
        "Click the UPDATE button. This takes you back to the list of API gateways.",
        "You might need to wait a few minutes while the API Gateway is updated. An icon may appear to the left of the API gateway name,\nindicating that the gateway is being refreshed.",
        "To check whether the refresh is still in progress, click on the REFRESH button above the gateway name. After the icon to the left\nof the gateway name disappears, the gateway should be fully refreshed, and you can continue to the next step.",
        "To make sure that your external function works correctly with the new security configuration file, call your external function again.",
        "For details, see Calling an external function for GCP.",
        "None. You\u2019ve successfully created an external function for GCP.",
        "Was this page helpful?",
        "On this page"
    ]
}