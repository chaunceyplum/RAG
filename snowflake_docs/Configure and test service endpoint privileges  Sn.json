{
    "url": "https://docs.snowflake.com/en/developer-guide/snowpark-container-services/tutorials/advanced/tutorial-5-configure-test-service-role",
    "title": "Configure and test service endpoint privileges | Snowflake Documentation",
    "paragraphs": [
        "Feature \u2014 Generally Available",
        "Available to accounts in AWS and Microsoft Azure commercial regions, with some exceptions. For more information, see Available regions.",
        "In Tutorial 1, you use the same role to create and test a service. The role that creates the service is the service\u2019s owner role, so you\u2019re able to communicate with the service using that role.",
        "In this tutorial, you explore using a different role to communicate with the service.",
        "You grant this role the USAGE privilege using a service role that you define in the service specification.",
        "In this tutorial, you modify the Tutorial 1 as follows:",
        "Create a new role that you will use to communicate with the service.",
        "Modify the service specification as follows:",
        "Define two endpoints, instead of just one endpoint. Note that the second endpoint is added only to demonstrate how endpoint permissions work.",
        "Define a service role that is allowed to access only one of the two endpoints.",
        "Grant the service role to the new role you created to allow access to one of the service endpoints.",
        "Use the new role to communicate with the service endpoint.",
        "Follow Common Setup with the following modifications:",
        "Complete the common setup steps.",
        "Using the ACCOUNTADMIN role, execute the following script to create another role (service_function_user_role), replacing\nuser_name with the name of your Snowflake user. After creating the echo service, you use this role to communicate with the service.",
        "Follow Tutorial 1, steps 1 and 2, to build and upload an image to a repository in your account. Do not proceed with step 3 because you will create the service as part of this tutorial.",
        "To ensure you\u2019re in the right context for the SQL statements in this step, execute the following:",
        "To create the service, execute the following command using test_role (the service\u2019s owner role).",
        "Per the inline specification, the echo_service exposes two public endpoints but the service role (echoendpoint_role) grants USAGE privilege only on one of the endpoints.",
        "Verify the service is running.",
        "Using test_role (the service\u2019s owner role), grant the service role defined in the specification to the new role (service_function_user_role) you created as part of the common setup. Also grant USAGE privileges on the database and the schema.",
        "This service role grants the service_function_user_role USAGE privilege on the echoendpoint endpoint.",
        "To demonstrate that the service role name is case in-sensitive, the example uses the echoendpoint_Role role name.",
        "Create a service function to communicate with the service. You create a service function using the service_function_user_role (not the service\u2019s owner role) and use the service.",
        "Create a service function.",
        "Try creating another service function that refers to the echoservice2 endpoint for which the role has no access privilege. Therefore, the command should fail.",
        "Use the service function.",
        "To remove the resources you created, follow the steps in Tutorial 1 steps to clean up other resources created in Tutorial 1.",
        "Now that you\u2019ve completed this tutorial, you can return to Working with Services to explore other topics.",
        "Was this page helpful?"
    ]
}